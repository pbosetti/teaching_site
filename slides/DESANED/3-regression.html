<!DOCTYPE html>
<html lang="en"><head>
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Paolo Bosetti">
  <title>Paolo Bosetti – Regression</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-f5b10fc125ee2ba6c83f7620df646e3b.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-77EMP7T5YY"></script>

  <script type="text/plain" cookie-consent="tracking">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-77EMP7T5YY', { 'anonymize_ip': true});
  </script>
  
  <script type="text/javascript" charset="UTF-8">
  document.addEventListener('DOMContentLoaded', function () {
  cookieconsent.run({
    "notice_banner_type":"simple",
    "consent_type":"express",
    "palette":"light",
    "language":"en",
    "page_load_consent_levels":["strictly-necessary"],
    "notice_banner_reject_button_hide":false,
    "preferences_center_close_button_hide":false,
    "website_name":""
    ,
  "language":"en"
    });
  });
  </script> 
    
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Regression</h1>
  <p class="subtitle"></p><p>Design of Experiments and Statistical Analysis of Experimental Data, 2024<br>
<img data-src="images/by-nc-sa.png" height="30"></p><p></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Paolo Bosetti 
</div>
        <p class="quarto-title-affiliation">
            Università di Trento, Dipartimento di Ingegneria Industriale
          </p>
    </div>
</div>

</section>
<section>
<section id="regression" class="title-slide slide level1 center">
<h1>Regression</h1>
<p><span class="math inline">\(\renewcommand{\hat}[1]{\widehat{#1}}\)</span> <span class="math inline">\(\renewcommand{\tilde}[1]{\widetilde{#1}}\)</span> <span class="math inline">\(\renewcommand{\theta}{\vartheta}\)</span></p>
<p>Each <strong>model</strong> of a physical system or process depends on <strong>parameters</strong>. These parameters must be calculated <strong>adapting</strong> the model to experimental observations (measurements)</p>
<p>The operation of <em>fitting</em> a model is carried out using <strong>regression</strong></p>
</section>
<section id="basics" class="slide level2">
<h2>Basics</h2>
<ul>
<li><p>A model of a physical system can be expressed as: <span class="math display">\[
   y=f(x_1, x_2, \dots, x_n, c_1, c_2, \dots, c_m)
\]</span> where <span class="math inline">\(x_i\)</span> are the physical (random) variables, called <strong>regressors</strong> or <strong>predictors</strong>, while the <span class="math inline">\(c_i\)</span> are the <strong>parameters</strong> (constant) of the model, and <span class="math inline">\(y\)</span> is the <strong>response</strong> or dependent variable</p></li>
<li><p>If <span class="math inline">\(n=1\)</span> there is a single predictor and a single dependent variable we talk about <strong>simple regression</strong></p></li>
<li><p>For example, <span class="math inline">\(y=a+bx+cx^2\)</span> is a simple linear model with parameters <span class="math inline">\(a,~b,~c\)</span></p></li>
<li><p><strong>regressing the model</strong> means making measurements of <span class="math inline">\(y\)</span> for different values of <span class="math inline">\(x\)</span> and determining the values of the parameters <span class="math inline">\(a,~b,~c\)</span> that <strong>minimize the distance</strong> between the model and experimental observations</p></li>
</ul>
</section>
<section id="types-of-regression" class="slide level2">
<h2>Types of regression</h2>
<p>We will consider three types of regression:</p>
<ul>
<li>Linear regression: the model is a <strong>linear combination of parameters</strong></li>
<li>Generalized linear regression</li>
<li>Least squares regression: parameters are combined in a non-linear way</li>
</ul>
</section></section>
<section>
<section id="linear-regression" class="title-slide slide level1 center">
<h1>Linear Regression</h1>
<p>Valid for every model that is <strong>linear in the parameters</strong> (while predictors can appear with a degree other than 1)</p>
</section>
<section id="basics-1" class="slide level2 smaller">
<h2>Basics</h2>
<p>The <strong>statistical model</strong> of a process with <span class="math inline">\(n\)</span> parameters to be regressed is defined as follows: <span class="math display">\[
y_i=f(x_{1i}, x_{2i}, \dots, y_{ni}) = \hat{y_i} + \varepsilon_{ij},~~~i=1,2,\dots,N
\]</span></p>
<p>where <span class="math inline">\(i\)</span> is the observation index (<span class="math inline">\(N\geq n+1\)</span> in total), <span class="math inline">\(\hat{y_i}\)</span> is the <strong>regressed value</strong>, or <strong>prediction</strong>, at the observation <span class="math inline">\(i\)</span>, and <span class="math inline">\(\varepsilon_{ij}\)</span> are the <strong>residuals</strong></p>
<ul>
<li>The regressed value corresponds to the <strong>deterministic component</strong></li>
<li>The residuals are the <strong>random component</strong></li>
<li>The hypothesis of <strong>normality of the residuals</strong> is assumed, i.e.&nbsp;that <span class="math inline">\(\varepsilon_{ij} \sim\mathcal{N}(0, \sigma^2)\)</span></li>
</ul>
<div class="fragment">
<p>If the <span class="math inline">\(f(\cdot)\)</span> is an analytical function with one predictor and linear in the coefficients, then we can express it as <span class="math inline">\(\mathbf{A}\mathbf{k}=\mathbf{y}\)</span>, where</p>
<ul>
<li><span class="math inline">\(\mathbf{y}\)</span> is the vector of <span class="math inline">\(y_i,~i=1\dots N\)</span></li>
<li><span class="math inline">\(\mathbf{k}\)</span> is the vector of parameters <span class="math inline">\(c_j,~j=1\dots n+1\)</span></li>
<li><span class="math inline">\(\mathbf{A}\)</span> a matrix <span class="math inline">\(N\times (n+1)\)</span> composed as follows:</li>
</ul>
<p><span class="math display">\[
\mathbf A = \begin{bmatrix}
x_1^{n-1} &amp; x_1^{n-2} &amp; \dots &amp; x_1 &amp; 1 \\
x_2^{n-1} &amp; x_2^{n-2} &amp; \dots &amp; x_2 &amp; 1 \\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
x_N^{n-1} &amp; x_N^{n-2} &amp; \dots &amp; x_N &amp; 1 \\
\end{bmatrix}
\]</span></p>
</div>
</section>
<section id="basics-2" class="slide level2">
<h2>Basics</h2>
<p>The linear equation can be solved with the <strong>pseudo-inverse</strong> method: <span class="math display">\[
\begin{align}
\mathbf A^T \mathbf A\cdot \mathbf{k} &amp;= \mathbf A^T \cdot \mathbf{y} \\
(\mathbf A^T \mathbf A)^{-1} \mathbf A^T \mathbf A\cdot \mathbf{k} &amp;= (\mathbf A^T \mathbf A)^{-1} \mathbf A ^T \cdot \mathbf{y} \\
\mathbf{k} &amp;= (\mathbf A^T \mathbf A)^{-1} \mathbf A^T \cdot \mathbf{y}
\end{align}
\]</span> This relationship makes clear what is meant by <strong>linear regression</strong>: it has nothing to do with the <strong>degree of the regressed function</strong> (which is not required to be linear in the predictors!), but only with the equation <strong>linear in the parameters</strong> that represents the model</p>
<p><strong>NOTE</strong>:</p>
<ul>
<li>from the previous matrix equation it is clear that the regression can be performed if and only if <span class="math inline">\(N\geq n+1\)</span>, i.e.&nbsp;if the number of observations is at least equal to the number of parameters</li>
<li>even in the case of a <span class="math inline">\(f(x_1,x_2,\dots,x_n)\)</span>, if it is linear in the coefficients it is always possible to express it as <span class="math inline">\(\mathbf{A}\mathbf{k}=\mathbf{y}\)</span> and therefore solve it with the pseudo-inverse method</li>
</ul>
</section>
<section id="example" class="slide level2">
<h2>Example</h2>
<div class="columns">
<div class="column">
<p>Let the model to be regressed be of the type <span class="math inline">\(y_i=(ax_i + b) + \varepsilon_i\)</span>; then it can be represented as:</p>
<p><span class="math display">\[
\begin{bmatrix}
x_1 &amp; 1 \\
x_2 &amp; 1 \\
\vdots &amp; \vdots \\
x_N &amp; 1 \\
\end{bmatrix} \cdot
\begin{bmatrix}
a \\
b
\end{bmatrix} =
\begin{bmatrix}
y_1 \\
y_2 \\
\vdots \\
y_N
\end{bmatrix}
\]</span></p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-2-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p>The figure shows the observations as points with coordinates <span class="math inline">\((x_i, y_i)\)</span>, the regressed model as a <strong>red line</strong> (linear model in the coefficients <span class="math inline">\(a,~b\)</span> and first degree of the predictor <span class="math inline">\(x\)</span>) and the residuals <span class="math inline">\(\varepsilon_i\)</span> as blue segments representing the difference between the <span class="math inline">\(y_i\)</span> and the corresponding regressed value <span class="math inline">\(\hat{y_i}\)</span></p>
</section></section>
<section>
<section id="least-squares-regression" class="title-slide slide level1 center">
<h1>Least Squares Regression</h1>
<p>If the model is not linear in its parameters, it is still possible to regress it with the <strong>least squares</strong> method</p>
</section>
<section id="least-squares-regression-1" class="slide level2">
<h2>Least Squares Regression</h2>
<p>That is, we look for the set of parameter values that <strong>minimizes the distance</strong> between the model and the observations. This minimization can be achieved by defining an <strong>index of merit</strong> which represents the distance between the model and observations <strong>depending on the parameters</strong>: <span class="math display">\[
\Phi(c_1, c_2,\dots,c_m)=\sum_{i=1}^N \left(y_i - f(x_{1i},x_{2i},\dots,x_{ni}, c_1, c_2 ,\dots,c_m) \right)^2
\]</span><br>
</p>
<ul>
<li><p>If the <span class="math inline">\(f(\cdot)\)</span> is analytic and differentiable, then we can <strong>minimize</strong> <span class="math inline">\(\Phi(\cdot)\)</span> by differentiation, i.e.&nbsp;by solving the system of <span class="math inline">\(m\)</span> equations <span class="math display">\[
\frac{\partial\Phi}{\partial c_i}(c_1,c_2,\dots,c_m) = 0
\]</span></p></li>
<li><p>If <span class="math inline">\(f(\cdot)\)</span> <strong>is not differentiable</strong>, the minimum of <span class="math inline">\(\Phi(\cdot)\)</span> can still be calculated numerically (e.g.&nbsp;Newton-Raphson method)</p></li>
</ul>
</section></section>
<section>
<section id="regression-quality" class="title-slide slide level1 center">
<h1>Regression quality</h1>
<p>To a given set of observations it is possible to fit <strong>an infinite number of models</strong></p>
<p>It is possible to define some <strong>parameters of merit</strong> and some <strong>verification methods</strong> that allow you to evaluate the quality of a regression and, therefore, identify the model that best fits the observations</p>
</section>
<section id="coefficient-of-determination" class="slide level2">
<h2>Coefficient of Determination</h2>
<div class="columns">
<div class="column">
<ul>
<li><p>The coefficient of merit most used to evaluate a regression is the <strong>coefficient of determination</strong> <span class="math inline">\(R^2\)</span></p></li>
<li><p>It is defined as <span class="math inline">\(R^2 = 1 - \frac{SS_\mathrm{res}}{SS_\mathrm{tot}}\)</span>, where <span class="math inline">\(SS_\mathrm{res} = \sum \varepsilon_i^2\)</span> and <span class="math inline">\(SS_ \mathrm{tot} = \sum(y_i - \bar y)^2\)</span></p></li>
<li><p>If the regressed values correspond to the observed values <span class="math inline">\(y_i=\hat{y_i}\)</span>, then the residuals are all zero and <span class="math inline">\(R^2 = 1\)</span></p></li>
<li><p>The quality of the regression decreases as <span class="math inline">\(R^2\)</span> decreases</p></li>
</ul>
</div><div class="column">
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Two datasets</a></li><li><a href="#tabset-1-2">Same set, two models</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-3-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-4-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div></div>

<aside><div>
<p><strong>Note</strong>: As you can see, the values of the regressors do not need to be equally spaced!</p>
</div></aside></section>
<section id="underfitting" class="slide level2">
<h2>Underfitting</h2>
<div class="columns">
<div class="column">
<p>There is <strong>underfitting</strong> when the model has a lower degree than the apparent behavior of the observations</p>
<p>It can be highlighted, in addition to a low <span class="math inline">\(R^2\)</span>, by studying the distribution of the residuals: if there is under-fitting the residuals can be non-normal and, above all, show <strong>trends</strong>, or <em>patterns </em></p>
<p>A <em>pattern</em> is a regular trend of the residuals as a function of the regressors</p>
<p>From the number of maximums and minimums present in the possible <em>pattern</em> it is possible to estimate <strong>how many degrees are missing</strong></p>
</div><div class="column">
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">Underfitting</a></li><li><a href="#tabset-2-2">Correct fit</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-5-1.png" width="1500"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-5-2.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-6-1.png" width="1500"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-6-2.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div></div>
</section>
<section id="overfitting" class="slide level2">
<h2>Overfitting</h2>
<div class="columns">
<div class="column">
<p>If the degree of the model is excessive, the model tends to <strong>chase individual points</strong></p>
<p>The value of <span class="math inline">\(R^2\)</span> increases, reaching 1 when the degree equals the number of observations minus 1</p>
<p>However, the model <strong>loses generality</strong> and is no longer able to correctly predict <strong>new values</strong> acquired at a later time (the red crosses in the figure)</p>
<p>Overfitting has particularly dramatic effects in case of <strong>extrapolation</strong>, i.e.&nbsp;when evaluating the model outside the range into which it has been regressed</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-7-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="prediction-bands" class="slide level2">
<h2>Prediction Bands</h2>
<div class="columns">
<div class="column">
<p>It is a band <strong>symmetric with respect to the regression</strong> within which the observations (present and future) have an assigned probability of falling</p>
<p>In general, for a sufficiently large number of observations (<span class="math inline">\(&gt;50\)</span>) the 95% prediction band contains 95% of the observations</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-8-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="confidence-bands" class="slide level2">
<h2>Confidence Bands</h2>
<div class="columns">
<div class="column">
<p>It is a band symmetric with respect to the regression within which <strong>the expected value of the model</strong> has an assigned probability of falling</p>
<p>It is always narrower than the prediction band</p>
<p>It is the multi-dimensional equivalent of the confidence interval for a T-test: as this is the interval, within which the value corresponding to the null hypothesis has an assigned probability of falling, here we can assume that the “<em>true</em>” model falls within the confidence band with a certain probability</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-9-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p>It is obtained by calculating the confidence intervals on the regression parameters, then calculating—for each value of the predictor—the maximum and minimum value of the regression corresponding to the extreme values of the parameters in their confidence intervals</p>
</section></section>
<section>
<section id="generalized-linear-regression" class="title-slide slide level1 center">
<h1>Generalized Linear Regression</h1>
<p>Classic linear regression assumes the hypothesis of <strong>normality of residuals</strong></p>
<p>When this hypothesis is not true, but the <strong>model is still linear in the parameters</strong>, generalized linear regression can be used</p>
</section>
<section id="basics-3" class="slide level2">
<h2>Basics</h2>
<p>In the case of linear regression: <span class="math display">\[
\begin{align}
y_i &amp;= f(\mathbf{x}_i, \mathbf{k}) + \varepsilon_i = \eta_i + \varepsilon_i \\
\varepsilon_i &amp;\sim \mathcal{N}(0, \sigma^2)
\end{align}
\]</span> In the case of <strong>generalized linear regression</strong>:</p>
<p><span class="math display">\[
\begin{align}
y_i &amp;= \eta_i + \varepsilon_i \\
\varepsilon_i &amp;\sim D(p_1,p_2,\dots,p_k)
\end{align}
\]</span> where <span class="math inline">\(D\)</span> is a generic distribution with <span class="math inline">\(k\)</span> parameters belonging to the <strong>family of exponential distributions</strong> (normal, binomial, gamma, inverse normal, Poisson, quasinormal, quasibinomial and quasipoissonian)</p>
<p>The problem can be solved by introducing a <strong>link function</strong> that rescales the residuals by projecting them onto a normal distribution</p>
</section>
<section id="basics-4" class="slide level2">
<h2>Basics</h2>
<p>The <strong>link function</strong> <span class="math inline">\(g(\cdot)\)</span> is such that:</p>
<p><span class="math display">\[
\begin{align}
y_i &amp;= \eta_i + g(\varepsilon_i) \\
\varepsilon_i &amp;\sim D(p_1,p_2,\dots,p_k);~g(\varepsilon_i)\sim \mathcal{N}(0, \sigma^2)
\end{align}
\]</span> The link functions for the most common distributions are:</p>
<div class="columns">
<div class="column">
<table class="caption-top">
<thead>
<tr class="header">
<th>Distribution</th>
<th>Link function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Normal</td>
<td><span class="math inline">\(g(x)=x\)</span></td>
</tr>
<tr class="even">
<td>Binomial</td>
<td><span class="math inline">\(g(x)=\mathrm{logit}(x)\)</span></td>
</tr>
<tr class="odd">
<td>Poisson</td>
<td><span class="math inline">\(g(x)=\log(x)\)</span></td>
</tr>
<tr class="even">
<td>Range</td>
<td><span class="math inline">\(g(x)=1/x\)</span></td>
</tr>
</tbody>
</table>
<p>In particular, it holds: <span class="math inline">\(\mathrm{logit}(x)=\frac{1}{1+e^{-p(x-x_0)}}\)</span></p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-10-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="logistic-regression" class="slide level2">
<h2>Logistic Regression</h2>
<div class="columns">
<div class="column">
<p>The typical case of logistic regression is the <strong>binomial event</strong> classifier</p>
<p>we consider a process that, depending on one or more predictors, can provide a result that can only be valid for one of two alternatives (success/failure, broken/intact, true/false, 1/0). We want to <strong>identify the threshold of predictors</strong> that switches the outcome</p>
<p>A linear regression is not suitable for the situation: it is clear that the <strong>residuals are not normal</strong> and that the slope of the regression depends a lot on how many points are collected in the “safe” zones</p>
</div><div class="column">
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">Data</a></li><li><a href="#tabset-3-2">Linear model residuals</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-11-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-12-1.png" width="1500"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-12-2.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div></div>
</section>
<section id="logistic-regression-1" class="slide level2">
<h2>Logistic Regression</h2>
<div class="columns">
<div class="column">
<p>The regressed logistic function provides the parameter <span class="math inline">\(x_0\)</span> which identifies the value that separates an <strong>equal amount of false positives and false negatives</strong></p>
<p>Furthermore, it is possible to identify the appropriate threshold to obtain a predetermined probability of false positives (or false negatives)</p>
<p>This is the simplest type of <strong>machine learning</strong>: a binomial classifier</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-13-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section></section>
<section>
<section id="presentation-of-data" class="title-slide slide level1 center">
<h1>Presentation of data</h1>
<p>The concept of <strong>confidence band</strong> is essential in the graphical presentation of data from multiple series</p>
</section>
<section id="graphic-comparison-of-multiple-series" class="slide level2">
<h2>Graphic comparison of multiple series</h2>
<div class="columns">
<div class="column">
<p>Suppose we have a process whose value depends on a variable <span class="math inline">\(x\)</span></p>
<p>Suppose that a process parameter <span class="math inline">\(S\)</span> can affect the output value. For example:</p>
<ul>
<li>the value is the hardness of a metal, <span class="math inline">\(x\)</span> is the temperature, the parameter <span class="math inline">\(S\)</span> is the quantity of an alloying element</li>
<li>the value is the productivity of a plant, <span class="math inline">\(x\)</span> is a quantitative process parameter, the parameter <span class="math inline">\(S\)</span> is the type of machine used</li>
</ul>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-15-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p>Suppose we repeat 8 times a measurement of the output value for the various combinations of <span class="math inline">\(x\)</span> and <span class="math inline">\(S\)</span>, obtaining the results in the figure: <strong>which differences are significant</strong>?</p>
</section>
<section id="without-a-reference-model" class="slide level2">
<h2>Without a reference model</h2>
<div class="columns">
<div class="column">
<p>Without a reference model that expresses <span class="math inline">\(v=f(x, S)\)</span> <strong>it makes no sense to perform a regression</strong></p>
<p>However, I can report, for each <strong>treatment</strong></p>
<ul>
<li>the average value, joining the series with a broken line for the sole purpose of visually grouping the data</li>
<li>the limits of the confidence interval for each series and for each treatment</li>
<li>or, join the limits with a band representing <strong>confidence about the mean</strong></li>
</ul>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-16-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p><strong>Areas where the bands overlap are statistically indistinguishable</strong></p>
</section>
<section id="with-a-model" class="slide level2">
<h2>With a model</h2>
<div class="columns">
<div class="column">
<p><strong>Only if I have a model <span class="math inline">\(v=f(x, S)\)</span></strong> I can perform a regression</p>
<p>Also in this case, the regression must be accompanied with confidence bands</p>
<p>Again, <strong>areas where the bands overlap are statistically indistinguishable</strong></p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3-regression_files/figure-revealjs/unnamed-chunk-17-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>paolo.bosetti@unitn.it — <a href="https://paolobosetti.quarto.pub/DESANED">https://paolobosetti.quarto.pub/DESANED</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,

        height: 720,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
          let selectedAnnoteEl;
          const selectorForAnnotation = ( cell, annotation) => {
            let cellAttr = 'data-code-cell="' + cell + '"';
            let lineAttr = 'data-code-annotation="' +  annotation + '"';
            const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
            return selector;
          }
          const selectCodeLines = (annoteEl) => {
            const doc = window.document;
            const targetCell = annoteEl.getAttribute("data-target-cell");
            const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
            const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            const lines = annoteSpan.getAttribute("data-code-lines").split(",");
            const lineIds = lines.map((line) => {
              return targetCell + "-" + line;
            })
            let top = null;
            let height = null;
            let parent = null;
            if (lineIds.length > 0) {
                //compute the position of the single el (top and bottom and make a div)
                const el = window.document.getElementById(lineIds[0]);
                top = el.offsetTop;
                height = el.offsetHeight;
                parent = el.parentElement.parentElement;
              if (lineIds.length > 1) {
                const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                height = bottom - top;
              }
              if (top !== null && height !== null && parent !== null) {
                // cook up a div (if necessary) and position it 
                let div = window.document.getElementById("code-annotation-line-highlight");
                if (div === null) {
                  div = window.document.createElement("div");
                  div.setAttribute("id", "code-annotation-line-highlight");
                  div.style.position = 'absolute';
                  parent.appendChild(div);
                }
                div.style.top = top - 2 + "px";
                div.style.height = height + 4 + "px";
                div.style.left = 0;
                let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                if (gutterDiv === null) {
                  gutterDiv = window.document.createElement("div");
                  gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                  gutterDiv.style.position = 'absolute';
                  const codeCell = window.document.getElementById(targetCell);
                  const gutter = codeCell.querySelector('.code-annotation-gutter');
                  gutter.appendChild(gutterDiv);
                }
                gutterDiv.style.top = top - 2 + "px";
                gutterDiv.style.height = height + 4 + "px";
              }
              selectedAnnoteEl = annoteEl;
            }
          };
          const unselectCodeLines = () => {
            const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
            elementsIds.forEach((elId) => {
              const div = window.document.getElementById(elId);
              if (div) {
                div.remove();
              }
            });
            selectedAnnoteEl = undefined;
          };
            // Handle positioning of the toggle
        window.addEventListener(
          "resize",
          throttle(() => {
            elRect = undefined;
            if (selectedAnnoteEl) {
              selectCodeLines(selectedAnnoteEl);
            }
          }, 10)
        );
        function throttle(fn, ms) {
        let throttle = false;
        let timer;
          return (...args) => {
            if(!throttle) { // first call gets through
                fn.apply(this, args);
                throttle = true;
            } else { // all the others get throttled
                if(timer) clearTimeout(timer); // cancel #2
                timer = setTimeout(() => {
                  fn.apply(this, args);
                  timer = throttle = false;
                }, ms);
            }
          };
        }
          // Attach click handler to the DT
          const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
          for (const annoteDlNode of annoteDls) {
            annoteDlNode.addEventListener('click', (event) => {
              const clickedEl = event.target;
              if (clickedEl !== selectedAnnoteEl) {
                unselectCodeLines();
                const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
                if (activeEl) {
                  activeEl.classList.remove('code-annotation-active');
                }
                selectCodeLines(clickedEl);
                clickedEl.classList.add('code-annotation-active');
              } else {
                // Unselect the line
                unselectCodeLines();
                clickedEl.classList.remove('code-annotation-active');
              }
            });
          }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>