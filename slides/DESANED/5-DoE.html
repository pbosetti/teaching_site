<!DOCTYPE html>
<html lang="en"><head>
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.30">

  <meta name="author" content="Paolo Bosetti">
  <title>Paolo Bosetti – Design of Experiments</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-7959e9c508be0453617036fd3007b339.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-77EMP7T5YY"></script>

  <script type="text/plain" cookie-consent="tracking">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-77EMP7T5YY', { 'anonymize_ip': true});
  </script>
  
  <script type="text/javascript" charset="UTF-8">
  document.addEventListener('DOMContentLoaded', function () {
  cookieconsent.run({
    "notice_banner_type":"simple",
    "consent_type":"express",
    "palette":"light",
    "language":"en",
    "page_load_consent_levels":["strictly-necessary"],
    "notice_banner_reject_button_hide":false,
    "preferences_center_close_button_hide":false,
    "website_name":""
    ,
  "language":"en"
    });
  });
  </script> 
    
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Design of Experiments</h1>
  <p class="subtitle"></p><p>Design of Experiments and Statistical Analysis of Experimental Data, 2025<br>
<img data-src="images/by-nc-sa.png" height="30"></p><p></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Paolo Bosetti 
</div>
        <p class="quarto-title-affiliation">
            University of Trento, Department of Industrial Engineering
          </p>
    </div>
</div>

</section>
<section>
<section id="design-and-analysis-of-experiments" class="title-slide slide level1 center">
<h1>Design (and Analysis) of Experiments</h1>
<p><span class="math inline">\(\renewcommand{\hat}[1]{\widehat{#1}}\)</span> <span class="math inline">\(\renewcommand{\tilde}[1]{\widetilde{#1}}\)</span> <span class="math inline">\(\renewcommand{\theta}{\vartheta}\)</span></p>
<p><strong>Industrial experiments</strong> often involve numerous factors corresponding to possibly very complex <strong>models</strong></p>
<p>It is therefore necessary to <strong>minimize the number of treatments</strong> and, therefore, the cost of the experiment, and yet to obtain <strong>the same information</strong></p>
<p>The experiments must then be analyzed with a statistical approach</p>
</section>
<section id="industrial-experiment-or-scientific-experiment" class="slide level2">
<h2>Industrial experiment or scientific experiment?</h2>
<div class="columns">
<div class="column">
<p>A <strong>scientific experiment</strong> is generally conducted with the purpose of supporting or disproving a theory</p>
<ul>
<li>it is always based on a <strong>theoretical model</strong> to be verified</li>
<li>often the model focuses on the effect of a limited number of explanatory variables</li>
</ul>
</div><div class="column">
<p>In the <strong>industrial field</strong> this is often not possible:</p>
<ul>
<li>often a <strong>theoretical model</strong> for subject of the experiment is not available due to scientific, technical, or practical reasons</li>
<li>the <strong>interaction</strong> between multiple explanatory variables is often what matters most</li>
</ul>
</div></div>
<div class="fragment">
<p>For practical purposes, the <strong>design</strong> of the experiment is all the more important the higher the complexity (i.e.&nbsp;the number of factors involved)</p>
</div>
</section>
<section id="objectives-of-an-experiment" class="slide level2">
<h2>Objectives of an experiment</h2>
<p>In general, an experiment serves to:</p>
<ol type="1">
<li><strong>confirm</strong> a theoretical hypothesis (model): you want to verify the <span class="bgreen">form</span> <span class="math inline">\(y=f(\cdot)\)</span> of the theoretical model; the regression of the model is accompanied by the study of confidence intervals (analytical or bootstrap)</li>
<li><strong>calibrate</strong> the parameters of a model: the shape is known and we want to obtain the <span class="bgreen">parameter values</span>; generally a regression is carried out, collecting data under realistic operating conditions</li>
<li><strong>identify</strong> the explanatory variables that influence a process: the model may be unknown and we want to determine the <span class="bgreen">list of independent variables</span> that appear in the <span class="math inline">\(y=f(\cdot)\)</span>; the objective is to build an approximate empirical model, which can possibly be used as a starting point for the formulation of a theoretical model</li>
</ol>
</section>
<section id="dimensionality-of-an-experiment" class="slide level2">
<h2>Dimensionality of an experiment</h2>
<p>If the <strong>model of interest si simple</strong> (i.e.&nbsp;one predictor), the experiment consists of analyzing the response variable at a sequence of levels for the explanatory variable. The number of levels is correlated with the expected degree of the response: for a regression of degree <span class="math inline">\(m\)</span> you need <strong>at least</strong> <span class="math inline">\(l=m+1\)</span> levels</p>
<p>But if the model <strong>has multiple predictors</strong>, i.e.&nbsp;the output depends on <span class="math inline">\(n\)</span> explanatory variables, and each variable is investigated on <span class="math inline">\(l\)</span> levels, then the number of test conditions is <span class="math inline">\(l^n\)</span></p>
<p>If each test condition is then repeated <span class="math inline">\(r\)</span> times (to average the results), the number of individual experiments is <span class="math inline">\(rl^n\)</span></p>
<p>This number can become large and economically unsustainable <strong>very quickly</strong></p>

<aside><div>
<p>Suppose we have 4 parameters and 4 levels, repeating each test 3 times: the total number of tests is 768; if the parameters become 5, the number grows to 3072, i.e.&nbsp;4 times as much, a ratio which is also valid for the cost</p>
</div></aside></section></section>
<section>
<section id="factorial-plans" class="title-slide slide level1 center">
<h1>Factorial plans</h1>
<p>If in an experiment the only explanatory variable, or <span class="bgreen">factor</span>, takes on a <strong>sequence</strong> of values, in a <strong>multidimensional</strong> experiment the <span class="math inline">\(n\)</span> factors take on an <span class="math inline">\(n\)</span>-dimensional <strong>grid</strong> of values, called <strong>factorial plan </strong></p>
</section>
<section id="factorial-plan" class="slide level2">
<h2>Factorial plan</h2>
<div class="columns">
<div class="column">
<ul>
<li>Two factors, <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span></li>
<li>We investigate 2 levels for each factor indicated as <span class="math inline">\(X-\)</span> and <span class="math inline">\(X+\)</span></li>
<li>Let’s change <strong>one level at a time</strong></li>
<li>We evaluate each treatment <strong>only 1 time</strong></li>
<li>Let’s evaluate the <strong>effects</strong> of <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>: <span class="math display">\[
   \begin{align}
   A &amp;= 50 - 20 = 30\\
   B &amp;= 30 - 20 = 10
   \end{align}
   \]</span></li>
</ul>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-2-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="yates-notation" class="slide level2">
<h2>Yates notation</h2>
<p>When the levels of all factors are only two, the <strong>Yates order</strong> can be used to indicate the combinations of levels:</p>
<ul>
<li>Factors and effects of factors are indicated with capital letters</li>
<li>Treatments are indicated with combinations of lowercase letters
<ul>
<li>letter present means factor at high level</li>
<li>absent letter means factor at low level</li>
<li>if all the letters are absent, write <span class="math inline">\((1)\)</span></li>
</ul></li>
</ul>

<aside><div>
<p>In the example on the previous slide, the treatments are <span class="math inline">\((1), a, b\)</span></p>
</div></aside></section>
<section id="factorial-plan-1" class="slide level2">
<h2>Factorial plan</h2>
<div class="columns">
<div class="column">
<p>Changing one factor at a time does not identify the <strong>interactions</strong></p>
<p>Interaction occurs when the <strong>effect</strong> of one factor depends on the <strong>level</strong> of another factor</p>
<p>In this second example we measure the response of treatments <span class="math inline">\((1), a, b, ab\)</span></p>
<p>We can estimate both the effects of <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> and the <strong>interaction</strong> <span class="math inline">\(AB\)</span>:</p>
<p><span class="math display">\[
\begin{align}
A &amp;= \frac{a+ab}{2} - \frac{(1) + b}{2} = 6\\
B &amp;= \frac{b+ab}{2} - \frac{(1) + a}{2} = -14 \\
AB &amp;= \frac{a+b}{2} - \frac{(1)+ab}{2} = -24
\end{align}
\]</span></p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-4-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="interaction-graph" class="slide level2">
<h2>Interaction graph</h2>
<div class="columns">
<div class="column">
<p>The concept of interaction is well illustrated by <strong>interaction graphs</strong></p>
<ul>
<li>If the two segments are <strong>parallel</strong> there is no interaction</li>
<li>If the two segments are <strong>crossed</strong> or convergent there is interaction</li>
<li>It is <strong>indifferent</strong> which factor is on the abscissa and which is on the series</li>
</ul>
</div><div class="column">
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Yield vs.&nbsp;A</a></li><li><a href="#tabset-1-2">Yield vs.&nbsp;B</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-5-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-6-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div></div>
</section>
<section id="response-surface" class="slide level2">
<h2>Response surface</h2>
<div class="columns">
<div class="column">
<p>The interaction graphs are nothing more than <strong>projections</strong> on the axis of one of the two factors of the <strong>response surface</strong></p>
<p><strong>Coded units</strong> are generally used, rescaling the range of each factor to the range <span class="math inline">\([-1,1]\)</span></p>
<p>This way you have the same sensitivity regardless of the original scale range</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-7-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p><strong>NOTE</strong>: Neither the response surface nor the interaction plots give any information on the <strong>statistical significance</strong> of the effects</p>
</section>
<section id="l2-factorial-plans" class="slide level2">
<h2><span class="math inline">\(l^2\)</span> factorial plans</h2>
<p>In general, an experiment in which you have 2 factors each tested on <span class="math inline">\(l\)</span> levels is a <span class="math inline">\(l^2\)</span> factorial design, because the <strong>total number of treatments</strong> is <span class="math inline">\(N=rl^2\)</span>, where <span class="math inline">\(r\)</span> is the number of repetitions for each treatment</p>
<p>The <strong>statistical model</strong> and regression model associated with the experiment are:</p>
<p><span class="math display">\[
y_{ijk} = \mu + \alpha_i + \beta_j + (\alpha\beta)_{ij} + \varepsilon_{ijk};\quad \hat y = \mu + \alpha x_1 + \beta x_2 + (\alpha\beta)x_1 x_2
\]</span> with <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> the values of the two factors in <strong>coded units</strong></p>
<p>As such, the experiment can be studied with a two-factor ANOVA (or <strong>two-way ANOVA</strong>):</p>
<div class="columns">
<div class="column">
<p><span class="math display">\[
\textrm{A)}~\left\{
\begin{align}
H_0&amp;: \alpha_1 = \alpha_2 = \dots =\alpha_a = 0 \\
H_1&amp;: \alpha_i \ne 0\quad\textrm{for at least one}~i
\end{align}
\right.
\]</span></p>
<p><span class="math display">\[
\textrm{B)}~\left\{
\begin{align}
H_0&amp;: \beta_1 = \beta_2 = \dots =\beta_b = 0 \\
H_1&amp;: \beta_j \ne 0\quad\textrm{for at least one}~j
\end{align}
\right.
\]</span></p>
</div><div class="column">
<p><span class="math display">\[
\textrm{AB)}~\left\{
\begin{align}
H_0&amp;: (\alpha\beta)_{ij} = 0\quad \forall~(i,j) \\
H_1&amp;: (\alpha\beta)_{ij} \ne 0\quad \textrm{for at least one}~(i,j)
\end{align}
\right.
\]</span></p>
</div></div>
</section>
<section id="l2-factorial-plans-1" class="slide level2">
<h2><span class="math inline">\(l^2\)</span> factorial plans</h2>
<p>These pairs of hypotheses correspond to a decomposition of the <strong>corrected total square sum</strong> <span class="math inline">\(SS_\mathrm{tot}=SS_A + SS_B + SS_{AB} + SS_E\)</span></p>
<p>The corresponding ANOVA table is:</p>
<table class="caption-top" style="width:100%;">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th>Effect</th>
<th><span class="math inline">\(\nu\)</span> (GdL)</th>
<th><span class="math inline">\(SS\)</span></th>
<th><span class="math inline">\(MS\)</span></th>
<th><span class="math inline">\(F_0\)</span></th>
<th><em>p</em>-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td><span class="math inline">\(a-1\)</span></td>
<td><span class="math inline">\(SS_A\)</span></td>
<td><span class="math inline">\(SS_A/\nu_A\)</span></td>
<td><span class="math inline">\(MS_A/MS_E\)</span></td>
<td><span class="math inline">\(\mathrm{CDF}^+(F_{0,A}, \nu_A, \nu_E)\)</span></td>
</tr>
<tr class="even">
<td>B</td>
<td><span class="math inline">\(b-1\)</span></td>
<td><span class="math inline">\(SS_B\)</span></td>
<td><span class="math inline">\(SS_B/\nu_B\)</span></td>
<td><span class="math inline">\(MS_B/MS_E\)</span></td>
<td><span class="math inline">\(\mathrm{CDF}^+(F_{0,B}, \nu_B, \nu_E)\)</span></td>
</tr>
<tr class="odd">
<td>AB</td>
<td><span class="math inline">\((a-1)(b-1)\)</span></td>
<td><span class="math inline">\(SS_{AB}\)</span></td>
<td><span class="math inline">\(SS_{AB}/\nu_{AB}\)</span></td>
<td><span class="math inline">\(MS_{AB}/MS_E\)</span></td>
<td><span class="math inline">\(\mathrm{CDF}^+(F_{0,AB}, \nu_{AB}, \nu_E)\)</span></td>
</tr>
<tr class="even">
<td>Error</td>
<td><span class="math inline">\(ab(n-1)\)</span></td>
<td><span class="math inline">\(SS_E\)</span></td>
<td><span class="math inline">\(SS_E/\nu_E\)</span></td>
<td>—</td>
<td>—</td>
</tr>
<tr class="odd">
<td>Total</td>
<td><span class="math inline">\(abn-1\)</span></td>
<td><span class="math inline">\(SS_\mathrm{tot}\)</span></td>
<td><span class="math inline">\(SS_\mathrm{tot}/\nu_\mathrm{tot}\)</span></td>
<td>—</td>
<td>—</td>
</tr>
</tbody>
</table>
</section>
<section id="example" class="slide level2">
<h2>Example</h2>
<p>We want to study the effect of cutting speed (factor <span class="math inline">\(A\)</span>) and rake angle (factor <span class="math inline">\(B\)</span>) of a turning tool on tool life. The two factors are both <strong>quantitative</strong>; we decide to investigate three levels for each factor, repeating each treatment twice: factorial plan <span class="math inline">\(2\cdot 3^2\)</span></p>
<div class="columns">
<div class="column">
<ol type="1">
<li>preparation of the <strong>test grid</strong></li>
<li>randomization of the operative sequence</li>
<li>execution of experiments and data collection</li>
<li>formulation and verification of the statistical model</li>
<li>analysis of variance (ANOVA)</li>
<li>creation of the response surface</li>
</ol>
<p>Points 4 and 5 are possibly repeated</p>
</div><div class="column" style="font-size: 70%">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: right;">StdOrder</th>
<th style="text-align: right;">Angle</th>
<th style="text-align: right;">A</th>
<th style="text-align: right;">Speed</th>
<th style="text-align: right;">B</th>
<th style="text-align: right;">Repeat</th>
<th style="text-align: left;">Life</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>

<aside><div>
<p>For reasons of space, the table only reports the first half of the rows, corresponding to the first repetition</p>
</div></aside></section>
<section id="example-step-2." class="slide level2">
<h2>Example — step 2.</h2>
<div class="columns">
<div class="column">
<p>In the grid, a new column of randomly ordered integers <span class="math inline">\(\left&lt;1\dots N\right&gt;,~N=rl^n\)</span> is generated</p>
<p>The grid is rearranged according to the new column, usually called <em>Run Order</em></p>
</div><div class="column" style="font-size: 60%;">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: right;">StdOrder</th>
<th style="text-align: right;">RunOrder</th>
<th style="text-align: right;">Angle</th>
<th style="text-align: right;">A</th>
<th style="text-align: right;">Speed</th>
<th style="text-align: right;">B</th>
<th style="text-align: right;">Repeat</th>
<th style="text-align: left;">Life</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">15</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">16</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
</section>
<section id="example-step-3." class="slide level2">
<h2>Example — step 3.</h2>
<div class="columns">
<div class="column">
<p>The experiments are carried out according to the <em>run order</em></p>
<p>By performing the experiments according to the <em>run order</em> possible <strong>unknown and uncontrolled</strong> effects are randomly distributed over all treatments:</p>
<ul>
<li>global variance increases (<span class="math inline">\(SS_\mathrm{tot}\)</span>)</li>
<li>the relative effect of the factors is not altered (<span class="math inline">\(SS_X\)</span>)</li>
</ul>
<p><strong>Note</strong>: a <em>repetition</em> is a replica of the entire experiment, not of the measurement operation alone</p>
</div><div class="column" style="font-size: 60%;">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: right;">StdOrder</th>
<th style="text-align: right;">RunOrder</th>
<th style="text-align: right;">Angle</th>
<th style="text-align: right;">A</th>
<th style="text-align: right;">Speed</th>
<th style="text-align: right;">B</th>
<th style="text-align: right;">Repeat</th>
<th style="text-align: right;">Life</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-3</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">15</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">16</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
</section>
<section id="example-step-4." class="slide level2">
<h2>Example — step 4.</h2>
<div class="columns">
<div class="column">
<p>We formulate the full quadratic regression model:</p>
<p><span class="math display">\[\begin{align}
\hat y = &amp; \mu + \alpha_1 x_1 + \beta_1 x_2 + (\alpha\beta)_1x_1x_2 + \\
          &amp; + \alpha_2x_1^2 + \beta_2x_2^2 + (\alpha\beta)_{2,1}x_1^2x_2 + \\
          &amp; + (\alpha\beta)_{1,2}x_1x_2^2 + (\alpha\beta)_{2,2}x_1^2x_2^2
      
\end{align}\]</span></p>
<p>where <span class="math inline">\((\alpha\beta)\)</span> is not a product: it represents the coefficient of a product of factors <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span></p>
<p><strong>It is necessary to evaluate normality and absence of pattern in the residuals</strong></p>
</div><div class="column">
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1"><span class="math inline">\(\varepsilon(A)\)</span></a></li><li><a href="#tabset-2-2"><span class="math inline">\(\varepsilon(B)\)</span></a></li><li><a href="#tabset-2-3"><span class="math inline">\(\varepsilon(r)\)</span></a></li><li><a href="#tabset-2-4">Quantile-Quantile</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-12-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-13-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-3">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-14-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-4">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-15-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div></div>
</section>
<section id="example-step-5." class="slide level2">
<h2>Example — step 5.</h2>
<div class="columns">
<div class="column">
<p>Choosing 5% as the threshold on the <em>p</em>-value, we observe that these effects are <strong>statistically insignificant</strong>:</p>
<ul>
<li><span class="math inline">\(B^2\)</span>, corresponding to the <span class="math inline">\(\beta_2\)</span> term in the regression</li>
<li><span class="math inline">\(A^2B\)</span>, corresponding to the <span class="math inline">\((\alpha\beta)_{2,1}\)</span> term in the regression</li>
</ul>
</div><div class="column" style="font-size: 65%;">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<colgroup>
<col style="width: 20%">
<col style="width: 8%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">effect</th>
<th style="text-align: right;"><span class="math inline">\(\nu\)</span></th>
<th style="text-align: right;"><span class="math inline">\(SS\)</span></th>
<th style="text-align: right;"><span class="math inline">\(MS\)</span></th>
<th style="text-align: right;"><span class="math inline">\(F_0\)</span></th>
<th style="text-align: right;"><span class="math inline">\(p\mathrm{-value}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(A\)</span></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8.333333</td>
<td style="text-align: right;">8.333333</td>
<td style="text-align: right;">5.769231</td>
<td style="text-align: right;">0.0397723</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(B\)</span></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">21.333333</td>
<td style="text-align: right;">21.333333</td>
<td style="text-align: right;">14.769231</td>
<td style="text-align: right;">0.0039479</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(A^2\)</span></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16.000000</td>
<td style="text-align: right;">16.000000</td>
<td style="text-align: right;">11.076923</td>
<td style="text-align: right;">0.0088243</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(B^2\)</span></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4.000000</td>
<td style="text-align: right;">4.000000</td>
<td style="text-align: right;">2.769231</td>
<td style="text-align: right;">0.1304507</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(AB\)</span></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8.000000</td>
<td style="text-align: right;">8.000000</td>
<td style="text-align: right;">5.538462</td>
<td style="text-align: right;">0.0430650</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(A^2B\)</span></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.666667</td>
<td style="text-align: right;">2.666667</td>
<td style="text-align: right;">1.846154</td>
<td style="text-align: right;">0.2073056</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(AB^2\)</span></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">42.666667</td>
<td style="text-align: right;">42.666667</td>
<td style="text-align: right;">29.538462</td>
<td style="text-align: right;">0.0004137</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(A^2B^2\)</span></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8.000000</td>
<td style="text-align: right;">8.000000</td>
<td style="text-align: right;">5.538462</td>
<td style="text-align: right;">0.0430650</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\varepsilon\)</span></td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">13.000000</td>
<td style="text-align: right;">1.444444</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
<p>So the regression equation becomes: <span class="math display">\[\begin{align}
\hat y = &amp; \mu + \alpha_1 x_1 + \beta_1 x_2 + (\alpha\beta)_1x_1x_2 + \\
          &amp; + \alpha_2x_1^2 + (\alpha\beta)_{1,2}x_1x_2^2 + \\
          &amp; + (\alpha\beta)_{2,2}x_1^2x_2^2
      
\end{align}\]</span></p>
</section>
<section id="example-step-6." class="slide level2">
<h2>Example — step 6.</h2>
<div class="columns">
<div class="column">
<p>The <strong>response surface</strong> allows you to identify notable points and directions:</p>
<ul>
<li>Point S is a saddle point, where the gradient is zero in any direction: stable point</li>
<li>At point P, the directions tangential to the isohypse are <strong>constant yield directions</strong></li>
<li>Point M is a <strong>maximum</strong> of yield</li>
</ul>
</div><div class="column" style="font-size: 65%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-17-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>

<aside><div>
<p>In general, a response surface is a <strong>hyper-surface</strong> in an <span class="math inline">\(n+1\)</span>-dimensional space, where <span class="math inline">\(n\)</span> is the number of factors</p>
</div></aside></section>
<section id="model-adequacy-analysis" class="slide level2">
<h2>Model adequacy analysis</h2>
<p>After possibly excluding some effects (for example <span class="math inline">\(B^2\)</span> and <span class="math inline">\(A^2B\)</span>) it is necessary to:</p>
<ol type="1">
<li>reformulate the model</li>
<li>analyze the residuals of the new model</li>
<li>confirm with a new ANOVA</li>
</ol>
<p>In particular, the analysis of the residuals is called <strong>model adequacy check</strong> (<em>Model Adequacy Check</em>, MAC) and typically consists of:</p>
<ul>
<li>checks for absence of patterns in the residuals depending on the factors</li>
<li>checks for absence of patterns in the residuals depending on the test order</li>
<li>verification of normality of residuals (Q-Q graph and Shapiro-Wilk test)</li>
</ul>
</section>
<section id="n-factorial-plan" class="slide level2">
<h2><span class="math inline">\(2^n\)</span> factorial plan</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p>Factor plans in which all factors have two levels (low and high, -1 and +1 in coded units) are of particular interest</p>
<ul>
<li>allow you to regress models only of the first degree</li>
<li>require minimal testing</li>
<li>they still allow to define the sensitivity of the process to the various factors, <strong>excluding non-significant factors</strong></li>
<li>are the starting point of any analysis of complex processes (i.e.&nbsp;with more than one explanatory variable)</li>
</ul>
</div><div class="column" style="width:40%;">
<p><img data-src="images/facplan1.png" width="350"></p>
</div></div>
</section>
<section id="n-factorial-plan-1" class="slide level2">
<h2><span class="math inline">\(2^n\)</span> factorial plan</h2>
<div class="columns">
<div class="column">
<ul>
<li>Each factor has two levels: low and high. In <strong>coded units</strong> -1 and +1 are valid, referred to for short as <strong>- and +</strong></li>
<li>The <strong>treatments</strong>, i.e.&nbsp;combinations of levels for the <span class="math inline">\(n\)</span> factors, are indicated with <strong>Yates notation</strong></li>
<li>the <strong>design matrix</strong> is obtained by permuting all the factors between - and + with frequencies gradually halved</li>
<li>the project matrix is repeated for the <span class="math inline">\(r\)</span> repetitions and also reports the <strong>random execution order</strong> column</li>
<li>the <strong>effects matrix</strong> is obtained by adding the columns for the interactions, calculated as the product of the relative signs</li>
</ul>
</div><div class="column" style="font-size: 85%; text-align: center;">
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">Design matrix</a></li><li><a href="#tabset-3-2">Effects matrix</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">treatment</th>
<th style="text-align: center;">repetition</th>
<th style="text-align: center;">A</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">C</th>
<th style="text-align: center;">order</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(1)</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">a</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">b</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">ab</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">c</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">ac</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bc</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">abc</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">treatment</th>
<th style="text-align: center;">I</th>
<th style="text-align: center;">A</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">AB</th>
<th style="text-align: center;">C</th>
<th style="text-align: center;">AC</th>
<th style="text-align: center;">BC</th>
<th style="text-align: center;">ABC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(1)</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">a</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
</tr>
<tr class="odd">
<td style="text-align: left;">b</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
</tr>
<tr class="even">
<td style="text-align: left;">ab</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">c</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
</tr>
<tr class="even">
<td style="text-align: left;">ac</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bc</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">abc</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div></div>
</section>
<section id="n-factorial-plan-2" class="slide level2">
<h2><span class="math inline">\(2^n\)</span> factorial plan</h2>
<p>The effects matrix contains the information to calculate the <strong>effects</strong> and the quadratic sums <span class="math inline">\(SS\)</span> which, in turn, are used to complete the ANOVA table</p>
<div class="columns">
<div class="column">
<p>For the effects: <span class="math display">\[
\begin{align}
A &amp;= \frac{-(1)+a-b+ab}{2r} \\
B &amp;= \frac{-(1)-a+b+ab}{2r} \\
AB &amp;= \frac{+(1)-a-b+ab}{2r}
\end{align}
\]</span></p>
</div><div class="column">
<p>For quadratic sums: <span class="math display">\[
\begin{align}
SS_A &amp;=&amp; \frac{(-(1)+a-b+ab)^2}{4r} \\
SS_B &amp;=&amp; \frac{(-(1)-a+b+ab)^2}{4r} \\
SS_{AB} &amp;=&amp; \frac{(+(1)-a-b+ab)^2}{4r}
\end{align}
\]</span></p>
</div></div>
<p>In general: <span class="math inline">\(\mathrm{E}(X) = \frac{2}{2^rn}\mathrm{Contrast}(X)\)</span> and <span class="math inline">\(\mathit{SS}(X) = \frac{1}{2 ^rn}\mathrm{Contrast}(X)^2\)</span> where the <strong>contrast</strong> of the factor <span class="math inline">\(\mathrm{Contrast}(X)\)</span> is calculated using the signs of the relevant column <span class="math inline">\(X\)</span> for the treatments in the order of Yates (e.g.&nbsp;<span class="math inline">\(\mathrm{Contrast}(AB)=+(1)-a-b+ab\)</span>)</p>
</section>
<section id="n-factorial-plan-statistical-model" class="slide level2">
<h2><span class="math inline">\(2^n\)</span> factorial plan: statistical model</h2>
<p>The <strong>statistical model</strong> of a <span class="math inline">\(2^n\)</span> factorial plan is obviously a first-order linear model in all factors. For <span class="math inline">\(n=2\)</span>, for example:</p>
<p><span class="math display">\[
y_{ijk} = \mu + \alpha_{i} + \beta_{j} + (\alpha\beta)_{ij}+\varepsilon_{ijk}
\]</span> For <span class="math inline">\(n=3\)</span>: <span class="math display">\[
y_{ijkl} = \mu + \alpha_{i} + \beta_{j} + (\alpha\beta)_{ij}+ \gamma_k + (\alpha\gamma)_{ik} + (\beta\gamma )_{jk} + (\alpha\beta\gamma)_{ijk} + \varepsilon_{ijkl}
\]</span> and so on.</p>
<p>In R we will see that these models can be abbreviated as <code>Y~A*B</code> and <code>Y~A*B*C</code> respectively and used to calculate the ANOVA table</p>

<aside><div>
<p>Exercise: derive the regression models corresponding to the two statistical models reported above</p>
</div></aside></section>
<section id="unreplicated-factorial-designs" class="slide level2">
<h2>Unreplicated factorial designs</h2>
<p>As the number of factors increases, the number of individual tests may become unsustainable</p>
<p>The simplest way to reduce the number of tests is to <strong>avoid repetitions for various treatments</strong></p>
<p>If a treatment is not repeated, however, it is not possible to calculate the <span class="math inline">\(SS_E\)</span> and therefore the ANOVA table cannot be completed with the <span class="math inline">\(F_0\)</span> and the <em>p</em>-values</p>
<p>The solution was proposed by C.&nbsp;Daniel and is based on the <strong>hypothesis that at least one of the factors or interactions <span style="text-decoration: underline;">is not significant</span></strong></p>
<p>This assumption is usually reasonable for more complex processes with large <span class="math inline">\(n\)</span>, precisely the cases where it is particularly important to reduce the number of tests</p>
<p>The idea is that <strong>non-significant effects</strong> are statistics calculated on different sub-samples of the same homogeneous sample, and therefore are normally distributed. Only the <strong>significant effects</strong> deviate from the normal distribution of the others</p>
</section>
<section id="daniels-method" class="slide level2">
<h2>Daniel’s method</h2>
<div class="columns">
<div class="column">
<p>Which effects are probably significant can therefore be determined with a quantile-quantile graph of them</p>
<p>The graph is a first screening which must be <strong>conservative</strong>: it only serves to remove effects that are certainly not significant (i.e.&nbsp;very aligned with the diagonal) and allow the execution of the ANOVA</p>
<p>The ANOVA table must however be calculated on a <strong>reduced linear statistical model</strong>, in order to confirm the result of the graphic method or to remove further effects that are actually non-significant</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-20-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="daniels-method-1" class="slide level2">
<h2>Daniel’s method</h2>
<div class="columns">
<div class="column">
<p>In this case only the effects <span class="math inline">\(A, C, D\)</span> and the interactions <span class="math inline">\(AC\)</span> and <span class="math inline">\(AD\)</span> are non-normal</p>
<p>The linear statistical model can then be reviewed as</p>
<p><span class="math display">\[
\begin{align}
y_{ijkl} =&amp; \mu + \alpha_{i} + \gamma_{j} + (\alpha\gamma)_{ij}+ \\
&amp;+\delta_k + (\alpha\delta)_{ik} + \varepsilon_{ijkl}
\end{align}
\]</span> That is, we can already rule out that <span class="math inline">\(B\)</span> is in fact a factor. In this way, instead of an unreplicated <span class="math inline">\(2^4\)</span> factorial plan we are dealing with a twice replicated <span class="math inline">\(2^3\)</span> (i.e.&nbsp;<span class="math inline">\(2\cdot 2^3\)</span>), for which we can perform a normal ANOVA analysis</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-21-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section></section>
<section>
<section id="transformations" class="title-slide slide level1 center">
<h1>Transformations</h1>
<p>In general, if the residuals of a linear model are non-normal, then <em>p</em>-values cannot be calculated from <span class="math inline">\(F_0\)</span></p>
<p>Often, however, it is possible to <strong>transform</strong> the response to make the residuals normal</p>
<p>The transformation can be any analytic function applied to the response</p>
</section>
<section id="example-1" class="slide level2">
<h2>Example</h2>
<div class="columns">
<div class="column">
<p>Let’s consider the data represented in this graph</p>
<p>It doesn’t matter where the data comes from: let’s just build a linear model of the data</p>
<p><span class="math display">\[ y_{ij} = \mu + x_i + \varepsilon_{ij}\]</span></p>
<p>Notice how the residuals do not look normal and that there are some obvious <strong>patterns</strong></p>
</div><div class="column">
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">Data</a></li><li><a href="#tabset-4-2">Resid. vs.&nbsp;x</a></li><li><a href="#tabset-4-3">Resid. vs.&nbsp;<span class="math inline">\(\hat y\)</span></a></li><li><a href="#tabset-4-4">Q-Q</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-23-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-24-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-3">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-25-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-4">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-26-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div></div>
</section>
<section id="example-2" class="slide level2">
<h2>Example</h2>
<div class="columns">
<div class="column">
<p>If we observe from the boxplot that the yield tends to increase more than linearly with <span class="math inline">\(x\)</span>, we can think of reformulating the model by <em>transforming</em> it through a squaring:</p>
<p><span class="math display">\[ y_{ij} = (\mu + x_i + \varepsilon_{ij})^2\]</span> The model no longer seems linear, but considering it can be rewritten as</p>
<p><span class="math display">\[ \sqrt{y_{ij}} = \mu + x_i + \varepsilon_{ij}\]</span></p>
<p>it is clear that it is still a <strong>linear model in the coefficients</strong>.</p>
</div><div class="column">
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-5-1">Residuals vs.&nbsp;x</a></li><li><a href="#tabset-5-2">Residuals vs.&nbsp;<span class="math inline">\(\hat y\)</span></a></li><li><a href="#tabset-5-3">Q-Q</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-27-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-28-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-3">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-29-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div></div>

<aside><div>
<p>Following this transformation it is therefore clear that the new model is more adequate, with pattern-free residuals and more compatible with a normal distribution</p>
</div></aside></section>
<section id="box-cox-transformations" class="slide level2">
<h2>Box-Cox transformations</h2>
<p>Box and Cox proposed a method to identify the <strong>best transformation</strong> in the family of power transformations <span class="math inline">\(y^* = y^\lambda\)</span>, with <span class="math inline">\(y^*=\ln(y)\)</span> when <span class="math inline">\(\lambda=0\)</span></p>
<p>We calculate a graph of the <strong>logarithmic likelihood</strong> <span class="math inline">\(\mathcal{L}\)</span> (<em>log-likelyhood</em>) of the following <span class="math inline">\(y^{(\lambda)}\)</span>:</p>
<p><span class="math display">\[
y_i^{(\lambda)} =
\begin{cases}
\frac{y_i^\lambda-1}{\lambda\dot y^{\lambda-1}} &amp; \lambda\neq 0 \\
\dot y \ln y_i &amp; \lambda = 0
\end{cases}, ~~~ \dot y = \exp\left[(1/n)\sum \ln y_i\right],~i=1, 2,\dots,n
\]</span> The likelihood <span class="math inline">\(\ln\mathcal{L}(\lambda|y)\)</span> is nothing more than the probability of extracting a sample <span class="math inline">\(y\)</span> given a certain parameter <span class="math inline">\(\lambda\)</span>. Its maximum coincides with the value of <span class="math inline">\(\lambda\)</span> which makes the sample <span class="math inline">\(y\)</span> more normal.</p>
</section>
<section id="box-cox-diagram" class="slide level2">
<h2>Box-Cox diagram</h2>
<div class="columns">
<div class="column">
<p>The Box-Cox diagram also identifies an interval corresponding to a variation of less than 95%.</p>
<p>Any value of <span class="math inline">\(\lambda\)</span> within this range is statistically equivalent</p>
<p>You then choose the value included in the range, <strong>which represents a “convenient” transformation</strong></p>
<p>For example, if the optimal <span class="math inline">\(\lambda\)</span> was 0.58, we would still choose <span class="math inline">\(\lambda=0.5\)</span>, which corresponds to the transformation <span class="math inline">\(y^*=\sqrt{y}\)</span></p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="5-DoE_files/figure-revealjs/unnamed-chunk-30-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>

<aside><div>
<p>Whenever a linear model is <strong>suspicious</strong> (in a <strong>regression</strong> or in <strong>factorial design analysis</strong>) it is a good idea to try a Box-Cox transformation. In FPs, sometimes the Box-Cox transformation can <strong>simplify the model</strong> (i.e.&nbsp;reduce the number of significant factors or interactions)</p>
</div></aside></section></section>
<section>
<section id="extensions-and-fractions-of-fps" class="title-slide slide level1 center">
<h1>Extensions and fractions of FPs</h1>
<p>An <span class="math inline">\(n^2\)</span> factorial plan assumes that the response is linear: this hypothesis must be verified by <strong>extending</strong> the plan to more than 2 levels</p>
<p>A factorial plan, even an unreplicated <span class="math inline">\(2^n\)</span>, can still be too onerous: in these cases it is possible to <strong>split it</strong>, i.e.&nbsp;divide the number of treatments by powers of 2, under penalty of losing information on the more complex interactions</p>
</section>
<section id="central-composite-design-ccd" class="slide level2">
<h2>Central Composite Design (CCD)</h2>
<div class="columns">
<div class="column">
<p>It would be automatic to <strong>extend</strong> a FP from <span class="math inline">\(2^2\)</span> to <span class="math inline">\(2^3\)</span> to evaluate quadratic effects</p>
<p>In this way, however, the <strong>sensitivity</strong> in the axial directions would be lower than the sensitivity in the diagonal directions, the evaluation interval being smaller in the first case</p>
<p>It is therefore preferable to perform centered FPs with <strong>rotational symmetry around the origin</strong></p>
<p>By two factors, the axial points are extended a distance <span class="math inline">\(\sqrt{2}\)</span> from the origin; in the generic <span class="math inline">\(n\)</span>-dimensional case the distance is <span class="math inline">\((2^k)^{1/4}\)</span></p>
</div><div class="column" style="text-align: center;">
<div class="panel-tabset">
<ul id="tabset-6" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-6-1">Two factors</a></li><li><a href="#tabset-6-2">Three factors</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1">
<p><img data-src="images/CCD2.png"></p>
</div>
<div id="tabset-6-2">
<p><img data-src="images/CCD3.png"></p>
</div>
</div>
</div>
</div></div>
</section>
<section id="fractional-factor-plans-ffp" class="slide level2">
<h2>Fractional Factor Plans (FFP)</h2>
<div class="columns">
<div class="column">
<p>Suppose we consider <strong>only</strong> the opposite vertices of the FP in the figure: <span class="math inline">\((1), ab, ac, bc\)</span></p>
<p>We are considering <strong>half of the original FP</strong>, which however includes all levels of the three factors</p>
<p>Splitting certainly reduces the completeness of the model, but it saves a lot of testing</p>
<ul>
<li>How to choose fractions for larger dimensions?</li>
<li>What information do we lose?</li>
</ul>
</div><div class="column" style="text-align: center;">
<p><img data-src="images/facplan1.png" width="350"></p>
</div></div>
</section>
<section id="choosing-fractions-defining-relationships" class="slide level2">
<h2>Choosing fractions: defining relationships</h2>
<div class="columns">
<div class="column">
<p>Looking at the <strong>effects matrix</strong>, we observe that the treatments <span class="math inline">\((1), ab, ac, bc\)</span> correspond to the rows for which the relation <span class="math inline">\(I=-ABC\)</span> holds. The other complementary half instead corresponds to <span class="math inline">\(I=ABC\)</span></p>
<p>These relations are called <strong>defining relationships</strong> because they define the FFP. It makes no difference whether you choose the positive or the negative half</p>
</div><div class="column" style="font-size: 85%; text-align: center;">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">treatment</th>
<th style="text-align: center;">I</th>
<th style="text-align: center;">A</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">AB</th>
<th style="text-align: center;">C</th>
<th style="text-align: center;">AC</th>
<th style="text-align: center;">BC</th>
<th style="text-align: center;">ABC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(1)</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">a</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
</tr>
<tr class="odd">
<td style="text-align: left;">b</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
</tr>
<tr class="even">
<td style="text-align: left;">ab</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">c</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
</tr>
<tr class="even">
<td style="text-align: left;">ac</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bc</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">abc</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>

<aside><div>
<p>The effects matrix for a fractional FP <span class="math inline">\(2^{n-1}\)</span> plus the defining relationship uniquely identify a fractional factorial plan</p>
</div></aside></section>
<section id="alias-and-information-loss" class="slide level2">
<h2><em>Alias</em> and information loss</h2>
<p>In a fractional FP <span class="math inline">\(2^{3-1}\)</span> with defining relationship <span class="math inline">\(I=ABC\)</span>, we consider these effects: <span class="math display">\[
\begin{align}
A &amp;= (-(1)+a-b+ab-c+ac-bc+abc)/(2r) \\
BC &amp;= (\underline{+(1)}+a-b\underline{-ab}-c\underline{-ac} \underline{+bc}+abc)/(2r)
\end{align}
\]</span> Since the underlined treatments <strong>are not tested</strong>, the <span class="math inline">\(A\)</span> effect is indistinguishable from the <span class="math inline">\(BC\)</span> effect</p>
<p>It is said that <span class="math inline">\(A\)</span> is <strong>aliased</strong> with <span class="math inline">\(BC\)</span></p>
<p>Given a certain defining relation, the possible alias structures can be obtained from the relation itself using a dedicated <strong>algebra</strong>: <span class="math inline">\(I\cdot X=X\)</span>, <span class="math inline">\(X\cdot X = X\)</span>, <span class="math inline">\(X\cdot Y =XY\)</span></p>
<p>Therefore, it results in <span class="math inline">\(A\cdot I=A\cdot ABC\)</span> i.e.&nbsp;<span class="math inline">\(A=BC\)</span>, and similarly <span class="math inline">\(B=AC\)</span> and <span class="math inline">\(C=AB\)</span></p>
</section>
<section id="alias-and-information-loss-1" class="slide level2">
<h2><em>Alias</em> and information loss</h2>
<p>Therefore, by splitting a FP you lose information: you lose the ability to discriminate between <em>aliased</em> effects. It is clear that the longer the defining relationship, the higher the degree of alias interactions with the direct effects will be (e.g.&nbsp;<span class="math inline">\(A=BCDEF\)</span>)</p>
<p>By virtue of the <strong>principle of sparsity of effects</strong>, however, this loss of information is not dramatic. The <strong>principle</strong> says that in a process the significance of high-level interactions is gradually less likely as the number of factors that compose them increases</p>
<p>Consequently, an alias <span class="math inline">\(A=BCDEF\)</span> can be neglected by assuming the significance of <span class="math inline">\(A\)</span> rather than that of <span class="math inline">\(BCDEF\)</span> by virtue of said Principle</p>
</section>
<section id="fractional-fp-of-type-2n-p" class="slide level2">
<h2>Fractional FP of type <span class="math inline">\(2^{n-p}\)</span></h2>
<p>It is possible to split a plan more than once, reducing the number of treatments to <span class="math inline">\(2^{n-p}\)</span></p>
<p>For each fraction it is necessary to choose a new defining relationship</p>
<p>For example, for <span class="math inline">\(2^{7-2}\)</span> you can choose the DRs <span class="math inline">\(I=ABCDE\)</span> and <span class="math inline">\(I=CDEFG\)</span></p>
<p>For these two DRs there is a third, dependent one: <span class="math inline">\(I=ABFG\)</span>. Any two of these three DRs are equivalent</p>
<h3 id="minimum-aberration-design">Minimum aberration design</h3>
<ul>
<li>All possible <span class="math inline">\(p\)</span>-tuples of defining relations are generated, completing them with the dependent one</li>
<li>Count the number of letters in the <span class="math inline">\((p+1)\)</span>-tuples (previous example: <span class="math inline">\(\left&lt;5,5,4\right&gt;\)</span>)</li>
<li>the <em>design</em> that minimizes the number of strings with minimum length is preferable because <strong>it has fewer aliases</strong></li>
</ul>
</section>
<section id="minimum-aberration-design-example" class="slide level2">
<h2>Minimum Aberration Design (example)</h2>
<div class="columns">
<div class="column">
<p>Compare these <span class="math inline">\(2^{7-2}_{IV}\)</span> designs:</p>
<dl>
<dt>Design A</dt>
<dd>
<p><span class="math inline">\(I = ABCF = BCDG~(= ADFG)\)</span>;</p>
</dd>
<dt>Design B</dt>
<dd>
<p><span class="math inline">\(I = ABCF = ADEG~(= BCDEFG)\)</span>;</p>
</dd>
<dt>Design C</dt>
<dd>
<p><span class="math inline">\(I=ABCDF=ABDEG~(=CEFG)\)</span></p>
</dd>
</dl>
<p><strong>Carefully select the defining relations!</strong></p>
</div><div class="column">
<table class="caption-top">
<caption>2nd level aliases:</caption>
<thead>
<tr class="header">
<th>Design A</th>
<th>Design B</th>
<th>Design C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(AB=CF\)</span></td>
<td><span class="math inline">\(AB=CF\)</span></td>
<td><span class="math inline">\(CE=FG\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(AC=BF\)</span></td>
<td><span class="math inline">\(AC=BF\)</span></td>
<td><span class="math inline">\(CF=EG\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(AD=FG\)</span></td>
<td><span class="math inline">\(AD=EG\)</span></td>
<td><span class="math inline">\(CG=EF\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(AG=DF\)</span></td>
<td><span class="math inline">\(AE=DG\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(BD=CG\)</span></td>
<td><span class="math inline">\(AF=BC\)</span></td>
<td></td>
</tr>
<tr class="even">
<td><span class="math inline">\(BG=CD\)</span></td>
<td><span class="math inline">\(AG=DE\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(AF=BC=DG\)</span></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div></div>
</section></section>
<section>
<section id="final-recommendations" class="title-slide slide level1 center">
<h1>Final recommendations</h1>
<p>It is very common to see DoE only partially applied…</p>
</section>
<section id="to-make-a-good-fp" class="slide level2">
<h2>To make a good FP</h2>
<ul>
<li>Start with <span class="math inline">\(2^n\)</span> and then increase it</li>
<li>Evaluate the opportunity for splitting and carefully choose the defining relationships</li>
<li><strong>always</strong> perform the model fit check and refine the statistical model accordingly</li>
<li>Discuss interactions and effects <strong>only after refining the model</strong></li>
<li>Evaluate the effects of <em>alias</em></li>
</ul>
<h3 id="advanced-themes">Advanced themes</h3>
<ul>
<li><em>Blocking</em></li>
<li><em>Minimum Aberration Design</em></li>
<li>Model transformations and Box-Cox transformations</li>
</ul>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>paolo.bosetti@unitn.it — <a href="https://paolobosetti.quarto.pub/DESANED">https://paolobosetti.quarto.pub/DESANED</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,

        height: 720,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/paolobosetti\.quarto\.pub\/teaching");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
            let selectedAnnoteEl;
            const selectorForAnnotation = ( cell, annotation) => {
              let cellAttr = 'data-code-cell="' + cell + '"';
              let lineAttr = 'data-code-annotation="' +  annotation + '"';
              const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
              return selector;
            }
            const selectCodeLines = (annoteEl) => {
              const doc = window.document;
              const targetCell = annoteEl.getAttribute("data-target-cell");
              const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
              const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
              const lines = annoteSpan.getAttribute("data-code-lines").split(",");
              const lineIds = lines.map((line) => {
                return targetCell + "-" + line;
              })
              let top = null;
              let height = null;
              let parent = null;
              if (lineIds.length > 0) {
                  //compute the position of the single el (top and bottom and make a div)
                  const el = window.document.getElementById(lineIds[0]);
                  top = el.offsetTop;
                  height = el.offsetHeight;
                  parent = el.parentElement.parentElement;
                if (lineIds.length > 1) {
                  const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                  const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                  height = bottom - top;
                }
                if (top !== null && height !== null && parent !== null) {
                  // cook up a div (if necessary) and position it 
                  let div = window.document.getElementById("code-annotation-line-highlight");
                  if (div === null) {
                    div = window.document.createElement("div");
                    div.setAttribute("id", "code-annotation-line-highlight");
                    div.style.position = 'absolute';
                    parent.appendChild(div);
                  }
                  div.style.top = top - 2 + "px";
                  div.style.height = height + 4 + "px";
                  div.style.left = 0;
                  let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                  if (gutterDiv === null) {
                    gutterDiv = window.document.createElement("div");
                    gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                    gutterDiv.style.position = 'absolute';
                    const codeCell = window.document.getElementById(targetCell);
                    const gutter = codeCell.querySelector('.code-annotation-gutter');
                    gutter.appendChild(gutterDiv);
                  }
                  gutterDiv.style.top = top - 2 + "px";
                  gutterDiv.style.height = height + 4 + "px";
                }
                selectedAnnoteEl = annoteEl;
              }
            };
            const unselectCodeLines = () => {
              const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
              elementsIds.forEach((elId) => {
                const div = window.document.getElementById(elId);
                if (div) {
                  div.remove();
                }
              });
              selectedAnnoteEl = undefined;
            };
              // Handle positioning of the toggle
          window.addEventListener(
            "resize",
            throttle(() => {
              elRect = undefined;
              if (selectedAnnoteEl) {
                selectCodeLines(selectedAnnoteEl);
              }
            }, 10)
          );
          function throttle(fn, ms) {
          let throttle = false;
          let timer;
            return (...args) => {
              if(!throttle) { // first call gets through
                  fn.apply(this, args);
                  throttle = true;
              } else { // all the others get throttled
                  if(timer) clearTimeout(timer); // cancel #2
                  timer = setTimeout(() => {
                    fn.apply(this, args);
                    timer = throttle = false;
                  }, ms);
              }
            };
          }
            // Attach click handler to the DT
            const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
            for (const annoteDlNode of annoteDls) {
              annoteDlNode.addEventListener('click', (event) => {
                const clickedEl = event.target;
                if (clickedEl !== selectedAnnoteEl) {
                  unselectCodeLines();
                  const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
                  if (activeEl) {
                    activeEl.classList.remove('code-annotation-active');
                  }
                  selectCodeLines(clickedEl);
                  clickedEl.classList.add('code-annotation-active');
                } else {
                  // Unselect the line
                  unselectCodeLines();
                  clickedEl.classList.remove('code-annotation-active');
                }
              });
            }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>