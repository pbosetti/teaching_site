<!DOCTYPE html>
<html lang="it-IT"><head>
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.30">

  <meta name="author" content="Paolo Bosetti">
  <title>Paolo Bosetti – Serie Temporali</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-7959e9c508be0453617036fd3007b339.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-77EMP7T5YY"></script>

  <script type="text/plain" cookie-consent="tracking">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-77EMP7T5YY', { 'anonymize_ip': true});
  </script>
  
  <script type="text/javascript" charset="UTF-8">
  document.addEventListener('DOMContentLoaded', function () {
  cookieconsent.run({
    "notice_banner_type":"simple",
    "consent_type":"express",
    "palette":"light",
    "language":"en",
    "page_load_consent_levels":["strictly-necessary"],
    "notice_banner_reject_button_hide":false,
    "preferences_center_close_button_hide":false,
    "website_name":""
    ,
  "language":"it-IT"
    });
  });
  </script> 
    
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Serie Temporali</h1>
  <p class="subtitle"></p><p>Analisi Dati e Statistica, 2025–26<br>
<img data-src="images/by-nc-sa.png" height="30"></p><p></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Paolo Bosetti 
</div>
        <p class="quarto-title-affiliation">
            Università di Trento, Dipartimento di Ingegneria Industriale
          </p>
    </div>
</div>

  <p class="date"><em>Ultimo aggiornamento:</em> 29/09/2025</p>
</section>
<section>
<section id="serie-temporali" class="title-slide slide level1 center">
<h1>Serie Temporali</h1>
<p>Una <strong>serie temporale</strong> è costituita da una serie di osservazioni di una variabile aleatoria tale per cui l’influenza di un’osservazione sulle seguenti non possa essere trascurata e—quindi—tale che la dipendenza dal tempo risulti essenziale</p>
</section>
<section id="statistica-delle-serie-temporali" class="slide level2">
<h2>Statistica delle serie temporali</h2>
<p>Tutti i metodi di regressione visti fin ora sono basati sull’assunzione che la variabile aleatoria sia <span class="math inline">\(x\overset{IID}\sim \mathcal{N}(\mu, \sigma^2)\)</span>. Cioè tutte le osservazioni <strong>devono essere non-autocorrelate</strong></p>
<p>Quest’assunzione è, tra l’altro, alla base della raccomandazione di casualizzazione della sequenza operativa</p>
<p>Supponiamo di poter considerare una misura come un segnale tempo-dipendente. È evidente che riducendo l’intervallo di campionamento del segnale prima o poi ogni campione sarà correlato al precedente</p>
<p>Esiste quindi una <strong>frequenza di campionamento massima</strong> al di sopra della quale ogni misura risulta essere autocorrelata, cioè <strong>le osservazioni di <span class="math inline">\(x\)</span> non sono più IID</strong></p>
<p>Questa situazione sussiste quando la <strong>dinamica</strong> propria dello strumento di misura o del misurando stesso—che sono <strong>sempre finite</strong>—sono più lente dell’intervallo temporale in cui si effettuano le misure</p>
</section>
<section id="statistica-delle-serie-temporali-1" class="slide level2">
<h2>Statistica delle serie temporali</h2>
<div class="columns">
<div class="column">
<p>Consideriamo ad esempio la serie temporale in figura che riporta la differenza tra la temperatura media delle terre emerse e il corrispondente valore medio nel periodo 1951–1980</p>
<p>È evidente che osservazioni vicine sono più correlate di osservazioni lontane</p>
<p>Inoltre è evidente (<strong>ed è di interesse</strong>) valutare la dipendenza della v.a. considerata dal tempo allo scopo di <strong>effettuare delle previsioni future</strong></p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-1-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="autocovarianza-e-autocorrelazione" class="slide level2">
<h2>Autocovarianza e autocorrelazione</h2>
<p>Abbiamo visto come gli operatori <strong>covarianza</strong> e <strong>correlazione</strong> servano a stimare l’indipendenza di due campioni</p>
<p>Considerando un segnale tempo-dipendente <span class="math inline">\(x=x(t)\)</span>, è interessante considerare la covarianza del segnale con se stesso, traslato nel tempo</p>
<p>Definiamo la <strong>funzione autocovarianza</strong> <span class="math inline">\(\gamma(s,t)\)</span> come la funzione che valuta la covarianza di un segnale temporale con se stesso valutato <strong>iniziando</strong> ai tempi <span class="math inline">\(s\)</span> e <span class="math inline">\(t\)</span>: <span class="math display">\[
\gamma_x(s, t) = \sigma_{x_s, x_t} = E[(x_s-\mu_s)(x_t-\mu_t)]
\]</span></p>
<p>È evidente che <span class="math inline">\(\gamma_x(s,s)=\sigma^2(x_s)\)</span></p>
<p>La <strong>funzione di autocorrelazione</strong> (ACF), di conseguenza, è definita come: <span class="math display">\[
\rho_x(s, t) = \frac{\gamma_x(s,t)}{\sqrt{\gamma_x(s,s)\gamma_x(t,t)}}
\]</span> ed ha il vantaggio di essere sempre compresa in <span class="math inline">\([-1,1]\)</span>. È inoltre evidente che <span class="math inline">\(\rho_x(s,s)=1\)</span></p>
</section>
<section id="autocorrelazione" class="slide level2">
<h2>Autocorrelazione</h2>
<p>Se campioniamo un segnale continuo a intervalli fissi <span class="math inline">\(\Delta t\)</span> per una durata complessiva <span class="math inline">\(T\)</span>, otteniamo una <strong>serie temporale finita</strong> di <span class="math inline">\(N=T/\Delta t\)</span> osservazioni: <span class="math inline">\(x_{0}=\left&lt;x_1, x_2, \dots, x_N\right&gt;\)</span></p>
<p>Possiamo estendere la definizione stabilendo che sia <span class="math inline">\(s=t_0 = 0\)</span> l’istante iniziale della serie e che sia <span class="math inline">\(t=s+\tau\)</span> un generico momento successivo tale per cui <span class="math display">\[
\tau = \ell \Delta t
\]</span> dove <span class="math inline">\(\ell\)</span> è il ritardo o <em>lag</em>, e allora l’<strong>autocovarianza</strong> e l’<strong>autocorrelazione per una s.t. finita</strong> risultano: <span class="math display">\[
\gamma_x(\ell) = \frac{\sum_{i=1}^{N-\ell} (x_i - \bar x_0) (x_{i+\ell}-\bar x_\ell) }{N-\ell-2},\quad \rho_x(\ell) = \frac{\gamma_x(\ell)}{\sqrt{\sigma_x(0)\sigma_x(\ell)}}
\]</span> dove <span class="math display">\[
\bar x_0=\frac{1}{N-\ell}\sum\nolimits_{i=1}^{N-\ell} x_i,\quad \bar x_\ell=\frac{1}{N-\ell}\sum\nolimits_{i=\ell}^{N} x_i
\]</span></p>
</section>
<section id="autocorrelogramma-acf" class="slide level2">
<h2>Autocorrelogramma (ACF)</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-2-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:40%;">
<p>Per costruire il grafico ACF di una s.t. si trasla l’ascissa di <span class="math inline">\(\ell\)</span> campioni trascurando i primi <span class="math inline">\(\ell\)</span> campioni nella s.t. non traslata e gli ultimi <span class="math inline">\(\ell\)</span> campioni in quella traslata</p>
<p>Poi si calcola l’autocorrelazione tra le due serie</p>
<p>Il processo viene ripetuto per <span class="math inline">\(\ell=0, 1, \dots, n\)</span>, con <span class="math inline">\(n\)</span> scelto in funzione della dimensione della serie, tipicamente pari ad almeno 50 e comunque non oltre la metà della lunghezza della s.t.</p>
</div></div>
</section>
<section id="autocorrelogramma-acf-1" class="slide level2">
<h2>Autocorrelogramma (ACF)</h2>
<div class="columns">
<div class="column">
<p>La <strong>funzione di autocorrelazione</strong> <span class="math inline">\(\rho_x(\ell)\)</span> che è una funzione <strong>a valori discreti</strong>, può essere messa in grafico per studiare il <em>lag</em> massimo al di sopra del quale la serie storica <span class="math inline">\(x\)</span> non è più autocorrelata</p>
<p>In figura il segnale di un microfono che registra il suono “AAHH”. La serie è <strong>evidentemente periodica</strong> ogni 0.01 s</p>
<p>L’autocorrelogramma mostra <strong>autocorrelazione elevata</strong> fino a <span class="math inline">\(\ell=4\)</span>. Poi l’andamento è <strong>periodico</strong>, a confermare che la s.t. è autocorrelata con se stessa ogni circa 10 lag</p>
</div><div class="column">
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Serie storica</a></li><li><a href="#tabset-1-2">ACF</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-3-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-4-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div></div>

<aside><div>
<p><strong>ACF</strong> sta per <em>Auto-Correlation Function</em>; la banda evidenziata in blu è l’intervallo di confidenza al 95%. Inoltre, in generale vale sempre <span class="math inline">\(\rho_x(0)=1\)</span></p>
</div></aside></section>
<section id="autocorrelogramma-acf-2" class="slide level2">
<h2>Autocorrelogramma (ACF)</h2>
<div class="columns">
<div class="column">
<p>Consideriamo gli stessi dati della s.t. precedente, ma campionati in istanti casuali</p>
<p>Allora <span class="math inline">\(y\overset{IID}\sim \mathcal{N}(\mu, \sigma^2)\)</span> e quindi <span class="math inline">\(\rho_y(\ell) = 0~\forall \ell&gt;0\)</span></p>
<p>Come atteso, l’unico valore della ACF fuori dall’initervallo di confidenza è <span class="math inline">\(\rho_x(0)\)</span></p>
<p>In questo caso si dice anche che la s.t. è un <strong><em>random walk</em></strong></p>
</div><div class="column">
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">Serie storica</a></li><li><a href="#tabset-2-2">ACF</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-5-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-6-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div></div>
</section>
<section id="serie-temporali-stazionarie" class="slide level2">
<h2>Serie temporali stazionarie</h2>
<p>Una s.t. può essere stazionaria o meno. Si definiscono:</p>
<dl>
<dt>Serie temporale stazionaria in <strong>senso ampio</strong></dt>
<dd>
È una serie temporale per cui il comportamento probabilistico di una qualsiasi collezione di valori <span class="math inline">\(\left&lt;x_{t_1}, x_{t_2},\dots, x_{t_k}\right&gt;\)</span> è identico a quello della collezione traslata <span class="math inline">\(\left&lt;x_{t_1+h}, x_{t_2+h},\dots, x_{t_k+h}\right&gt;\)</span>, cioè: <span class="math display">\[
\mathrm{Pr}(x_{t_1}\leq c_1, \dots, x_{t_k}\leq c_k) = \mathrm{Pr}(x_{t_1+h}\leq c_1, \dots, x_{t_k+h}\leq c_k).
\]</span>
</dd>
<dt>Serie temporale stazionaria in <strong>senso stretto</strong></dt>
<dd>
È una serie temporale per cui il valor medio della serie temporale è costante (tempo-indipendente) e la funzione di autocovarianza <span class="math inline">\(\gamma(s,t)\)</span> dipende da <span class="math inline">\(s\)</span> e <span class="math inline">\(t\)</span> solo tramite la loro differenza <span class="math inline">\(|s-t|\)</span>
</dd>
</dl>
<p>Per una <strong>serie stazionaria in senso ampio</strong> si può assumere <span class="math inline">\(\sigma_x(0)=\sigma_x(\ell)=\sigma_x\)</span> e <span class="math inline">\(\bar x_0=\bar x_\ell\)</span> e, quindi, <span class="math inline">\(\rho_x(\ell) = \gamma_x(\ell)/\sigma_x\)</span></p>
</section>
<section id="stabilizzazione" class="slide level2">
<h2>Stabilizzazione</h2>
<ul>
<li>Le ST stazionarie almeno in senso ampio sono più semplici da trattare</li>
<li>È quindi utile cercare di <strong>stabilizzare</strong> la ST separandola in un termine di <strong>tendenza</strong> (<em>trend</em>) <span class="math inline">\(x_t\)</span> più un termine <strong>stazionario</strong> <span class="math inline">\(x_s\)</span></li>
<li>la stabilizzazione può essere fatta in due modi:
<ul>
<li><em>detrending</em> mediante regressione lineare: <span class="math inline">\(x_t = x_{l,t} + x_{s,t}\)</span>, dove <span class="math inline">\(x_{l,t} = a + bt\)</span> e, quindi, <span class="math inline">\(x_{s,t}\)</span> risulta essere la <strong>serie dei residui</strong> della regressione lineare di <span class="math inline">\(x_t\)</span></li>
<li><em>detrending</em> per differenziazione</li>
</ul></li>
<li>La ST stabilizzata può poi essere analizzata e quindi ri-trasformata mediante l’operazione inversa:
<ul>
<li>somma del termine di tendenza</li>
<li>integrazione (cioè somma cumulativa)</li>
</ul></li>
</ul>
</section>
<section id="stabilizzazione-esempio" class="slide level2">
<h2>Stabilizzazione (esempio)</h2>
<div style="text-align: center;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-7-1.png" width="2400"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="operatori-di-differenziazione" class="slide level2">
<h2>Operatori di differenziazione</h2>
<p>In generale, la stabilizzazione per differenziazione dà risultati migliori ed è anche più pratica: se la ST differenziata non è stabile, è possibile aumentare l’ordine di differenziazione fino a raggiungere la stabilità</p>
<p>Come si differenzia una ST?</p>
<p>Si definiscono:</p>
<ul>
<li><strong>Operatore <em>backshift</em></strong>: è l’operatore <span class="math inline">\(B^n\)</span> tale per cui <span class="math inline">\(B^n x_t := x_{t-n}\)</span></li>
<li><strong>Operatore differenza</strong>: è l’operatore <span class="math inline">\(\nabla\)</span> tale per cui <span class="math inline">\(\nabla x_t := x_t - x_{t-1}=(1-B)x_t\)</span>. Risulta quindi che <span class="math inline">\(\nabla^dx_t=(1-B)^dx_t\)</span>, e quindi ad esempio <span class="math inline">\(\nabla^2x_t=(1-B)^2x_t=x_t-2x_{t-1}+x_{t-2}\)</span></li>
</ul>
<p>Quindi ad esempio la differenziazione <span class="math inline">\(\nabla^2x_t\)</span> è l’equivalente discreto della derivata seconda <span class="math inline">\(\frac{d^2}{dt^2}x(t)\)</span> per la funzione continua <span class="math inline">\(x(t)\)</span></p>
</section>
<section id="stabilizzazione-e-acf" class="slide level2">
<h2>Stabilizzazione e ACF</h2>
<div style="text-align: center;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-8-1.png" width="2400"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="stabilizzazione-e-acf-1" class="slide level2">
<h2>Stabilizzazione e ACF</h2>
<div class="columns">
<div class="column">
<ul>
<li>La ACF di una serie non stabilizzata mostra sempre una correlazione anche a <em>lag</em> elevati</li>
<li>La ACF della serie dei residui di una regressione lineare decresce più rapidamente, ma mantiene comunque una correlazione anche a <em>lag</em> elevati</li>
<li>La ACF della serie differenziata, inoltre, si smorza molto rapidamente (i <em>lag</em> 1, 2, 3, … dovrebbero essere esponenziali), dopodiché mostra oscillazioni armoniche, indice di una <strong>periodicità</strong> nella ST originale</li>
</ul>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-9-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>

<aside><div>
<p>Possiamo quindi dire che la serie storica del prezzo del pollo mostra un <em>trend</em> che si <strong>stabilizza al primo ordine</strong> di differenziazione, ha una dinamica che mostra <strong>autocorrelazione fino ai tre punti precedenti</strong>, e un andamento <strong>periodico</strong> con periodo pari a 12 <em>lag</em>.</p>
</div></aside></section></section>
<section>
<section id="modelli-statistici" class="title-slide slide level1 center">
<h1>Modelli statistici</h1>
<p>La regressione classica applicata alle serie temporali <strong>è spesso insufficiente</strong>. Ad esempio, nel caso del prezzo del pollo l’analisi della autocorrelazione mostra un comportamento ciclico che la regressione classica non riesce ad evidenziare</p>
<p>È quindi necessario sviluppare delle tecniche che consentano di modellare i dettagli di una serie temporale, in particolare tenendo in considerazione anche <strong>l’autocorrelazione</strong> che può caratterizzare le serie temporali</p>
</section>
<section id="modelli-ar-definizione" class="slide level2">
<h2>Modelli AR — definizione</h2>
<p>Un modello Auto-Regressivo (AR) esprime una determinata osservazione <span class="math inline">\(x_t\)</span> al tempo <span class="math inline">\(t\)</span> come combinazione lineare di <span class="math inline">\(p\)</span> valori precedenti <span class="math inline">\(x_{t-1}, x_{t-2},\dots,x_{t-p}\)</span>. Un modello AR di ordine <span class="math inline">\(p\)</span>, abbreviato in <span class="math inline">\(\mathrm{AR}(p)\)</span>, ha la forma: <span class="math display">\[
x_t=\phi_1 x_{t-1} + \phi_2 x_{t-2}+\dots+\phi_p x_{t-p} + w_t \label{eq:AR}
\]</span></p>
<ul>
<li><span class="math inline">\(x_t\)</span> è stazionaria in senso ampio e <span class="math inline">\(w_t\sim\mathcal{N}(0, \sigma^2_w)\)</span></li>
<li><span class="math inline">\(\phi_1, \phi_2,\dots,\phi_p\)</span> sono costanti e <span class="math inline">\(\phi_p\neq0\)</span></li>
</ul>
<p>Se la media di <span class="math inline">\(x_t\)</span> non è nulla, si sostituisce <span class="math inline">\(x_t\)</span> con <span class="math inline">\(x_t - \mu\)</span> per ottenere: <span class="math display">\[
\begin{align}
x_t-\mu&amp;=\phi_1( x_{t-1}-\mu) + \phi_2 (x_{t-2}-\mu)+\dots+\phi_p (x_{t-p}-\mu) + w_t \\
x_t&amp;=\alpha + \phi_1 x_{t-1} + \phi_2 x_{t-2}+\dots+\phi_p x_{t-p} + w_t,~~~\alpha=\mu(1-\phi_1-\phi_2-\dots-\phi_p)
\end{align}
\]</span></p>

<aside><div>
<p>Le <span class="math inline">\(w_t\)</span> sono anche chiamate <strong>innovazioni</strong>, dato che sono l’unico contributo <strong>nuovo</strong> di un punto rispetto ai precedenti.</p>
</div></aside></section>
<section id="modelli-ar-regressione" class="slide level2">
<h2>Modelli AR — regressione</h2>
<p>Ricordando la definizione dell’<strong>operatore <em>backshift</em></strong>, la definizione di <span class="math inline">\(w_t\)</span> può essere scritta come:</p>
<p><span class="math display">\[
(1-\phi_1 B - \phi_2 B^2 -\dots-\phi_p B^p)x_t=w_t
\]</span> o ancora più concisamente come:</p>
<p><span class="math display">\[
\Phi_p(B)x_t=w_t
\]</span> dove <span class="math inline">\(\Phi_p(B):=1-\phi_1B-\phi_2B^2-\dots-\phi_pB^p\)</span> è detto <strong>operatore autoregressivo</strong>.</p>
<p>Effettuare la regressione di un modello <span class="math inline">\(\mathrm{AR}(p)\)</span> su una serie storica <span class="math inline">\(x_t\)</span> significa quindi adattare il modello <span class="math inline">\(\Phi_p(B)\hat{ x_t}=w_t\)</span> identificando i coefficienti di <span class="math inline">\(\Phi_p(B)\)</span> che minimizzano i residui quadratici medi, essendo i residui <span class="math inline">\(\varepsilon_t = x_t - \hat{ x_t} = x_t - \Phi_p^{-1}(B)w_t\)</span> (ammesso che esista l’inversa <span class="math inline">\(\Phi_p^{-1}(B)\)</span>).</p>
</section>
<section id="modelli-ma-definizione" class="slide level2">
<h2>Modelli MA — definizione</h2>
<p>Alternativamente, è possibile immaginare il caso in cui la generica osservazione <span class="math inline">\(x_t\)</span> è espressa come combinazione lineare <strong>del disturbo</strong> agente sulle <span class="math inline">\(q\)</span> osservazioni precedenti. Un modello MA di ordine <span class="math inline">\(q\)</span>, abbreviato come <span class="math inline">\(\mathrm{MA}(q)\)</span> è definito come <span class="math display">\[
x_t = w_t + \theta_1 w_{t-1} + \theta_2 w_{t-2} + \dots + \theta_q w_{t-q}
\]</span></p>
<ul>
<li><span class="math inline">\(w_t\sim\mathcal{N}(0, \sigma_w^2)\)</span></li>
<li><span class="math inline">\(\theta_1, \theta_2,\dots,\theta_q\)</span> sono parametri costanti con <span class="math inline">\(\theta_q\neq0\)</span></li>
</ul>
</section>
<section id="modelli-ma-regressione" class="slide level2">
<h2>Modelli MA — regressione</h2>
<p>Analogamente al caso <span class="math inline">\(\mathrm{AR}(p)\)</span>, per <span class="math inline">\(\mathrm{MA}(q)\)</span> è possibile definire l’<strong>operatore media mobile</strong> di ordine <span class="math inline">\(q\)</span>: <span class="math display">\[
\Theta_q(B)=(1+\theta_1 B+\theta_2 B^2+\dots+\theta_q B^q)
\]</span> tale per cui la equazione per <span class="math inline">\(x_t\)</span> può essere scritta come:</p>
<p><span class="math display">\[
x_t=\Theta_q(B)w_t
\]</span></p>
<p>Come sopra, regredire un modello <span class="math inline">\(\mathrm{MA}(q)\)</span> ad una serie storica <span class="math inline">\(x_t\)</span> significa identificare i termini di <span class="math inline">\(\Theta_q(B)\)</span> che minimizzano i residui quadratici medi, definiti come <span class="math inline">\(\varepsilon_t = x_t - \hat{x_t} = x_t - \Theta_q(B)\)</span> (si noti che questa volta non c’è l’inversa!)</p>
</section>
<section id="modelli-ma-e-acf" class="slide level2">
<h2>Modelli MA e ACF</h2>
<div class="columns">
<div class="column">
<p>Una ST <span class="math inline">\(MA(q)\)</span> ha una memoria che si estende fino al <em>lag</em> <span class="math inline">\(q\)</span>, nel senso che le innovazioni a distanze superiori a <span class="math inline">\(q\)</span> non hanno alcun effetto sull’ultima osservazione</p>
<p>Quindi, data una serie temporale di tipo <span class="math inline">\(MA(q)\)</span> si può spesso identificare l’ordine dalla sua ACF, contando i picchi dopo quello a <em>lag</em> 0:</p>
<ul>
<li>tre picchi fuori dalla banda di confidenza significano un modello <span class="math inline">\(MA(3)\)</span></li>
<li>i segni dei picchi corrispondono ai segni dei coefficienti</li>
</ul>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-11-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="modelli-ma-e-acf-1" class="slide level2">
<h2>Modelli MA e ACF</h2>
<div class="columns">
<div class="column">
<p>Se invece la serie temporale è di tipo <span class="math inline">\(AR(p)\)</span>, ogni osservazione dipende dall’innovazione e da tutte le osservazioni precedenti, in modo ricorsivo</p>
<p>In questo caso l’autocorrelogramma riporterà un decadimento esponenziale seguito eventualmente da oscillazioni armoniche</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-13-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="modelli-ar-e-pacf" class="slide level2">
<h2>Modelli AR e PACF</h2>
<p>Per i modelli di tipo <span class="math inline">\(AR(p)\)</span> è comunque possibile identificare l’ordine mediante la <strong>funzione di autocorrelazione parziale</strong> o PACF, così definita:</p>
<p><span class="math display">\[
\begin{align}
\mathrm{PACF}_1 &amp;= \mathrm{ACF}(z_{t+1}, z_t) \\
\mathrm{PACF}_k &amp;= \mathrm{ACF}(z_{t+k} - \hat{z_{t+k}}, z_t - \hat{z_t}),~~~k\geq2 \\
\end{align}
\]</span> in cui <span class="math inline">\(\hat{z_{t+k}}\)</span> e <span class="math inline">\(\hat{z_t}\)</span> sono combinazioni lineari di <span class="math inline">\(\{z_{t+1}, z_{t+2},\dots,z_{t+k-1}\}\)</span> che minimizzano l’errore quadratico medio di <span class="math inline">\(z_{t+k}\)</span> e <span class="math inline">\(z_t\)</span>, rispettivamente</p>
</section>
<section id="modelli-ar-e-pacf-1" class="slide level2">
<h2>Modelli AR e PACF</h2>
<div class="columns">
<div class="column">
<p>In generale, quindi, se la ACF mostra una memoria infinita (modello AR) e la PACF mostra pochi picchi, il numero di picchi è l’ordine del modello AR</p>
<p><strong>Attenzione</strong>: non si considerano i picchi dopo il primo <em>cut-off</em>, cioè il <em>lag</em> in corrispondenza del quale l’autocorrelazione scende sotto il limite di confidenza per la prima volta</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-14-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>

<aside><div>
<p><strong>Attenzione</strong>: in questi grafici ACF e PACF il <em>lag</em> comincia da 1!</p>
</div></aside></section>
<section id="modelli-ma-e-pacf" class="slide level2">
<h2>Modelli MA e PACF</h2>
<div class="columns">
<div class="column">
<p>Confrontando sia ACF che PACF</p>
<ul>
<li>puro rumore: ACF e PACF sono nulle per <em>lag</em> maggiore di 0</li>
<li><span class="math inline">\(AR(p)\)</span>: ACF decresce lentamente, PACF non-nulla per <em>lag</em> minori o uguali a <span class="math inline">\(p\)</span>, nulla altrimenti</li>
<li><span class="math inline">\(MA(q)\)</span>: ACF mostra <span class="math inline">\(q\)</span> picchi; se <span class="math inline">\(PACF(1) &gt; 0\)</span>, PACF oscilla a 0, altrimenti decade geometricamente a 0</li>
</ul>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-15-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>

<aside><div>
<p>Spesso, in pratica queste indicazioni sono difficili da riscontrare ed è quindi difficile individuare <span class="math inline">\(p,q\)</span> in maniera certa e univoca</p>
</div></aside></section>
<section id="modelli-arma" class="slide level2">
<h2>Modelli ARMA</h2>
<p>L’ovvia estensione risulta dalla combinazione dei modelli <span class="math inline">\(\mathrm{AR}(p)\)</span> e <span class="math inline">\(\mathrm{MA}(q)\)</span></p>
<p>Un modello ARMA di ordine <span class="math inline">\(p,q\)</span>, abbreviato come <span class="math inline">\(\mathrm{ARMA}(p,q)\)</span> è definito come:</p>
<p><span class="math display">\[
x_t=\phi_1 x_{t-1} + \phi_2 x_{t-2}+\dots+\phi_p x_{t-p} + w_t + \theta_1 w_{t-1} + \theta_2 w_{t-2} + \dots + \theta_q w_{t-q}
\]</span> con <span class="math inline">\(\phi_p\)</span> e <span class="math inline">\(\theta_q\)</span> non nulli, ovvero, più brevemente: <span class="math display">\[
\Phi_p(B)x_t=\Theta_q(B)w_t
\]</span></p>
</section>
<section id="modelli-ma-e-pacf-1" class="slide level2">
<h2>Modelli MA e PACF</h2>
<div class="columns">
<div class="column">
<p>Confrontando sia ACF che PACF</p>
<ul>
<li>puro rumore: ACF e PACF sono nulle per <em>lag</em> maggiore di 0</li>
<li><span class="math inline">\(AR(p)\)</span>: ACF decresce lentamente, PACF non-nulla per <em>lag</em> minori o uguali a <span class="math inline">\(p\)</span>, nulla altrimenti</li>
<li><span class="math inline">\(MA(q)\)</span>: ACF mostra <span class="math inline">\(q\)</span> picchi; se <span class="math inline">\(PACF(1) &gt; 0\)</span>, PACF oscilla a 0, altrimenti decade geometricamente a 0</li>
<li><span class="math inline">\(ARMA(p,q)\)</span>: ACF mostra <span class="math inline">\(q\)</span> picchi; PACF decade geometricamente a 0 solo dopo <em>lag</em> <span class="math inline">\(p\)</span></li>
</ul>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-16-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div></div>

<aside><div>
<p>Spesso, in pratica queste indicazioni sono difficili da riscontrare ed è quindi difficile individuare <span class="math inline">\(p,q\)</span> in maniera certa e univoca</p>
</div></aside></section>
<section id="modelli-arima" class="slide level2">
<h2>Modelli ARIMA</h2>
<p>I processi <span class="math inline">\(\mathrm{ARMA}(p,q)\)</span> sono adatti solo a descrivere serie <strong>stazionarie</strong> in senso ampio</p>
<p>Abbiamo visto però che un processo non stazionario può essere reso tale per differenziazione di un opportuno grado <span class="math inline">\(d\)</span></p>
<p>Un processo <span class="math inline">\(x_t\)</span> è detto <span class="math inline">\(\mathrm{ARIMA}(p,d,q)\)</span> quando <span class="math inline">\(\nabla^d x_t = (1-B)^d x_t\)</span> 2è un processo <span class="math inline">\(\mathrm{ARMA}(p,q)\)</span></p>
<p>In generale, quando <span class="math inline">\(E(\nabla^dx_t)=0\)</span> il processo <span class="math inline">\(\mathrm{ARIMA}(p,d,q)\)</span> può essere scritto come: <span class="math display">\[
\Phi_p(B)\nabla^dx_t=\Theta_q(B)w_t
\]</span> Se invece il valore atteso <span class="math inline">\(E(\nabla^dx_t)=\mu\)</span>, allora: <span class="math display">\[
\Phi_p(B)\nabla^dx_t=\delta + \Theta_q(B)w_t,~~~\delta=\mu(1-\phi_1-\dots-\phi_p)
\]</span></p>
</section>
<section id="stabilità-e-unicità-dei-modelli" class="slide level2">
<h2>Stabilità e unicità dei modelli</h2>
<p>Consideriamo un modello <span class="math inline">\(\mathrm{AR}(1)\)</span>: possiamo sviluppare la formula ricorsiva come: <span class="math display">\[
\begin{align}
x_t =&amp; \phi x_{t-1}+w_t = \phi(\phi x_{t-2}+w_{t-1}) + w_t \\
=&amp; \sum_{j=0}^{+\infty}\phi^j w_{t-j}
\end{align}
\]</span> È quindi evidente che la serie temporale <span class="math inline">\(x_t\)</span> <strong>è stabile solo se</strong> <span class="math inline">\(|\phi|&lt;1\)</span></p>
<p>Nel caso generale del modello <span class="math inline">\(\mathrm{AR}(p)\)</span>, si ha la condizione di stabilità: <span class="math display">\[
\left|\sum_{i=1}^p \phi_i\right| &lt; 1 \label{eq:ARstab}
\]</span> Un modello AR non stabile è detto anche <strong>anti-causale</strong>, perché si può dimostrare che per essere stabilizzato richiede la conoscenza delle osservazioni future</p>
</section>
<section id="stabilità-e-unicità-dei-modelli-1" class="slide level2">
<h2>Stabilità e unicità dei modelli</h2>
<p>Per un modello <span class="math inline">\(\mathrm{MA}(1)\)</span>, invece, consideriamo due modelli: <span class="math display">\[
\begin{align}
x_t &amp;= w_t + \theta w_{t-1}, ~w_t\sim\mathcal{N}(0, 1) \\
y_t &amp;= \nu_t + 1/\theta \nu_{t-1}, ~\nu_t\sim\mathcal{N}(0, \theta^2)
\end{align}
\]</span> È evidente che <span class="math inline">\(x_t\)</span> e <span class="math inline">\(\nu_t\)</span> hanno la stessa ACF e sono indistinguibili, dato che noi non conosciamo le innovazioni <span class="math inline">\(w_t\)</span> e <span class="math inline">\(\nu_t\)</span> ma solo le due serie. Si può dimostrare che il risultato è generale (cioè non dipende dell’ordine <span class="math inline">\(q\)</span>).</p>
<p>È quindi necessario scegliere una delle due forme alternative. Per individuare quale, riscriviamo la serie come <span class="math inline">\(w_t=-\theta x_{t-1}+x_t\)</span>, che ha la stessa forma della <span class="math inline">\(\mathrm{AR}(1)\)</span>. Possiamo quindi scegliere l’alternativa che rispetta lo stesso criterio di <em>stabilità</em>: <span class="math display">\[
\left|\sum_{i=1}^q \theta_i\right| &lt; 1
\]</span> Tale alternativa si dice <strong>invertibile</strong></p>
</section>
<section id="stabilità-e-unicità-dei-modelli-2" class="slide level2">
<h2>Stabilità e unicità dei modelli</h2>
<p>In generale, si può dimostrare che i criteri visti sopra corrispondono a imporre il requisito che le radici complesse dei polinomi <span class="math display">\[
\begin{align}
\Phi_p(z)&amp;=1-\phi_1 z-\phi_2 z^2 - \dots -\phi_p z^p \\
\Theta_q(z)&amp;=1+\theta_1 z+\theta_2 z^2 + \dots +\theta_q z^q
\end{align}
\]</span> siano <strong>tutte strettamente fuori dal cerchio unitario</strong> sul piano complesso</p>
<p>Ad esempio: <span class="math inline">\(\mathrm{ARMA}(2,2)\)</span> con <span class="math inline">\(\Phi_2(z)= 1 + 0.9z + 0.1z^2\)</span> e <span class="math inline">\(\Theta_q(z) = 1 + 2z + 15z^2\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">abs</span>(<span class="fu">polyroot</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.9</span>, <span class="sc">-</span><span class="fl">0.1</span>)))</span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="fu">abs</span>(<span class="fu">polyroot</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">15</span>)))</span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2581989 0.2581989</code></pre>
</div>
</div>
<p>Cioè il termine AR non è causale e il termine MA non è invertibile (ma lo sarebbe <span class="math inline">\(\theta_q(z) = 1 + 1/2z + 1/15z^2\)</span>)</p>
</section>
<section id="ridondanza" class="slide level2">
<h2>Ridondanza</h2>
<p>Consideriamo il processo <span class="math inline">\(x_t = w_t\)</span>, con <span class="math inline">\(w_t\sim\mathcal{N}(0, 1)\)</span>: si tratta ovviamente di puro rumore casuale</p>
<p>Moltiplichiamo entrambi i lati per <span class="math inline">\(1-0.5B\)</span> per ottenere:</p>
<p><span class="math display">\[
x_t = 0.5x_{t-1}-0.5w_{t-1} + w_t
\]</span> che <strong>sembra</strong> un processo <span class="math inline">\(\mathrm{ARMA}(1,1)\)</span> ma ovviamente è sempre lo stesso rumore casuale. <strong>Come distinguere questi casi?</strong></p>
<ul>
<li>si scompongono in fattori i polinomi <span class="math inline">\(\Phi_p\)</span> e <span class="math inline">\(\Theta_q\)</span></li>
<li>si eliminano i <strong>fattori comuni</strong></li>
<li>si sicompongono i fattori per ottenere il <strong>modello non ridondante</strong></li>
</ul>
<p>In R si può ancora usare <code>polyroot()</code></p>
</section>
<section id="ridondanza-1" class="slide level2">
<h2>Ridondanza</h2>
<p>Ad esempio, consideriamo il processo <span class="math inline">\(x_t=0.4x_{t-1}+0.45x_{t-2}+w_t + w_{t-1}+0.25w_{t-2}\)</span>, che usando l’operatore <span class="math inline">\(B\)</span> diventa:</p>
<p><span class="math display">\[
(1-0.4B-0.45B^2)x_t = (1+B+0.25B^2)w_t.
\]</span></p>
<p>In questa forma il processo sembra <span class="math inline">\(\mathrm{ARMA}(2,2)\)</span>, tuttavia possiamo scomporre i due polinomi in fattori, usando <code>polyroot()</code> per calcolare le radici:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="co"># per Phi:</span></span>
<span id="cb5-2"><a></a><span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="fu">polyroot</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">0.45</span>))</span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.9-6.887768e-21i  0.5+2.125854e-21i</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="co"># per Theta:</span></span>
<span id="cb7-2"><a></a><span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="fu">polyroot</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>))</span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5+0i 0.5+0i</code></pre>
</div>
</div>

<aside><div>
<p><strong>Nota</strong>: se <span class="math inline">\(z_i,~ i=1,\dots,n\)</span> sono le radici del polinomio <span class="math inline">\(p(z)\)</span> di grado <span class="math inline">\(n\)</span>, allora il polinomio può essere scomposto nei fattori <span class="math inline">\((1-1/z_1 z)\cdot(1-1/z_2 z)\dots(1-1/z_n z)\)</span>.</p>
</div></aside></section>
<section id="ridondanza-2" class="slide level2">
<h2>Ridondanza</h2>
<p>Come si vede, si può scrivere <span class="math display">\[
\begin{align}
\Phi_p(B)&amp;=(1-0.9B)(1+0.5B) \\
\Theta_q(B)&amp;=(1+0.5B)^2
\end{align}
\]</span></p>
<p>Eliminando il fattore comune <span class="math inline">\((1+0.5B)\)</span> otteniamo il modello <span class="math display">\[
x_t=0.9x_{t-1}+0.5w_{t-1}+w_t
\]</span> che è un <span class="math inline">\(\mathrm{ARMA}(1,1)\)</span>.</p>
<p>Quindi ai criteri di <strong>causalità</strong> e di <strong>invertibilità</strong> si aggiunge il criterio di <strong>non ridondanza</strong> dei parametri, che si verifica eliminando ogni fattore comune dalla scomposizione in fattori dei polinomi <span class="math inline">\(\Phi_p(B)\)</span> e <span class="math inline">\(\Theta_q(B)\)</span>.</p>
</section>
<section id="regressione-sarima" class="slide level2">
<h2>Regressione (S)ARIMA</h2>
<p>Per quanto detto sopra, un processo, o serie temporale, <span class="math inline">\(x_t\)</span> può essere regredita mediante un modello ARIMA identificandone i parametri per <strong>minimizzazione degli scarti quadratici</strong></p>
<p>Tuttavia, prima della regressione è necessario definire gli indici <span class="math inline">\(p, d,q\)</span> adeguati, tali che non si abbia <strong>né sotto- né sovra-adattamento</strong></p>
<p>In certi casi, inoltre, le serie sono <strong>periodiche</strong>: oltre ad un possibile <strong>trend</strong> sono soggette anche a ciclici andamenti oscillanti. In questi casi:</p>
<ul>
<li>si rende la ST stazionaria per differenziazione</li>
<li>si separa un contributo a bassa frequenza, chiamato <strong>stagionale</strong>, da un contributo ad alta frequenza</li>
<li>si effettua separatamente la regressione del contributo stagionale e del contributo non stagionale come due processi ARIMA distinti e sovrapposti: tale regressione si chiama <em>Seasonal ARIMA</em> o <strong>SARIMA</strong></li>
</ul>
</section>
<section id="regressione-sarima-1" class="slide level2">
<h2>Regressione (S)ARIMA</h2>
<p>Inoltre, abbiamo visto che i modelli ARIMA si basano sull’ipotesi di serie temporali stazionarie in senso ampio</p>
<p>Quindi, è necessario che sia il <strong>valor medio che la varianza siano costanti nel tempo</strong></p>
<ul>
<li>La media si stabilizza per differenziazione</li>
<li>La varianza si può stabilizzare mediante <strong>trasformazioni Box-Cox</strong></li>
</ul>
<p>Quindi, nel caso più generale il modello è <span class="math inline">\(\mathrm{SARIMA}(p, d, q, p_s, d_s, q_s, \lambda)\)</span></p>
<p><strong>Prima di eseguire una regressione è quindi necessario definire i valori dei sette parametri, evitando sovra- e sotto-adattamento</strong></p>
<ul>
<li><span class="math inline">\(d, d_s\)</span> possono essere identificati per tentativi, aumentando gradualmente i valori (prima di <span class="math inline">\(d\)</span> e poi di <span class="math inline">\(d_s\)</span>) finché la ACF è soddisfacente</li>
<li>gli altri termini possono essere individuati verificando la bontà della regressione su una griglia di combinazioni e valutando un opportuno <strong>indice di merito</strong></li>
</ul>
</section>
<section id="akaike-information-criterion" class="slide level2">
<h2>Akaike Information Criterion</h2>
<p>L’indice di merito più usato nella regressione SARIMA è l’<strong>Akaike Information Criterion</strong>, o AIC</p>
<p>In genere la qualità di una regressione con <span class="math inline">\(k\)</span> parametri è misurata dalla somma quadratica dei residui, <span class="math inline">\(SS_E(k)\)</span>, normalizzata per la dimensione del campione <span class="math inline">\(n\)</span>: <span class="math display">\[
\hat{\sigma_k^2} = \frac{SS_E(k)}{n}
\]</span> Questo indicatore si chiama <strong><em>Maximum Likelihood Estimator</em></strong> (MLE). Più questo valore è piccolo, meglio il modello si adatta ai dati</p>
<p>Tuttavia aumentando <span class="math inline">\(k\)</span> si ha una diminuzione di MLE, a rischio di sovra-adattamento. Per questo motivo Akaike ha proposto di penalizzare MLE con il numero di parametri: <span class="math display">\[
\mathrm{AIC}=\log(\hat{\sigma_k^2})+\frac{n+2k}{n}
\]</span> L’AIC va ovviamente <strong>minimizzato</strong></p>
</section>
<section id="altri-criteri-di-informazione" class="slide level2">
<h2>Altri criteri di informazione</h2>
<p>Oltre all’AIC esistono anche l’AIC corretto e il <em>Bayesian Information Criterion</em>, o BIC:</p>
<ul>
<li>AIC corretto: <span class="math inline">\(\mathrm{AIC}_c = \log(\hat{\sigma_k^2})+\frac{n+k}{n-k-2}\)</span></li>
<li>BIC: <span class="math inline">\(\mathrm{BIC} = \log(\hat{\sigma_k^2})+\frac{k\log(n)}{n}\)</span></li>
</ul>
<p>Il BIC <strong>penalizza maggiormente la dimensione del modello</strong>, per cui è preferito per campioni molto grandi (migliaia di osservazioni), per i quali AIC e AICc tenderebbero a favorire modelli inutilmente complessi (troppi parametri, sovra-adattamento)</p>
<p>Come l’AIC, anche AICc e BIC vanno <strong>minimizzati</strong></p>
</section>
<section id="regressione" class="slide level2">
<h2>Regressione</h2>
<p>La libreria R <code>forecast</code> fornisce la funzione <code>auto.arima()</code> che valuta gli indicatori su una griglia di combinazioni dei sette parametri e fornisce la regressione migliore:</p>
<div class="columns">
<div class="column" style="font-size: 70%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(AirPassengers, <span class="at">lambda=</span><span class="st">"auto"</span>, <span class="at">trace=</span>T)</span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 ARIMA(2,1,2)(1,1,1)[12]                    : -890.0518
 ARIMA(0,1,0)(0,1,0)[12]                    : -845.0766
 ARIMA(1,1,0)(1,1,0)[12]                    : -885.6939
 ARIMA(0,1,1)(0,1,1)[12]                    : -896.9901
 ARIMA(0,1,1)(0,1,0)[12]                    : -860.1426
 ARIMA(0,1,1)(1,1,1)[12]                    : -895.2944
 ARIMA(0,1,1)(0,1,2)[12]                    : -895.3558
 ARIMA(0,1,1)(1,1,0)[12]                    : -889.5331
 ARIMA(0,1,1)(1,1,2)[12]                    : Inf
 ARIMA(0,1,0)(0,1,1)[12]                    : -880.0685
 ARIMA(1,1,1)(0,1,1)[12]                    : -896.1031
 ARIMA(0,1,2)(0,1,1)[12]                    : -895.698
 ARIMA(1,1,0)(0,1,1)[12]                    : -893.2768
 ARIMA(1,1,2)(0,1,1)[12]                    : -894.0835

 Best model: ARIMA(0,1,1)(0,1,1)[12]                    </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: AirPassengers 
ARIMA(0,1,1)(0,1,1)[12] 
Box Cox transformation: lambda= -0.2947046 

Coefficients:
          ma1     sma1
      -0.4355  -0.5847
s.e.   0.0908   0.0725

sigma^2 = 5.856e-05:  log likelihood = 451.59
AIC=-897.18   AICc=-896.99   BIC=-888.55</code></pre>
</div>
</div>
</div><div class="column">
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">Serie temporale</a></li><li><a href="#tabset-3-2">Stabilizzata</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-20-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-21-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div></div>
</section>
<section id="previsione" class="slide level2">
<h2>Previsione</h2>
<div class="columns">
<div class="column">
<p>Una volta selezionato il modello più adatto (quello con <strong>AIC minimo</strong>) si può procedere a regressione e predizione</p>
<p>La predizione può essere ottenuta con la funzione <code>forecast()</code></p>
<p>Tale funzione riporta anche le bande di confidenza al 95%</p>
</div><div class="column">
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">Predizione</a></li><li><a href="#tabset-4-2">Dettaglio</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-22-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="7-serie_temporali_files/figure-revealjs/unnamed-chunk-23-1.png" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div></div>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>paolo.bosetti@unitn.it — <a href="https://paolobosetti.quarto.pub/slides/ADAS/">https://paolobosetti.quarto.pub/slides/ADAS/</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,

        height: 720,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copiato!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copiato!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/pbosetti\.github\.io\/teaching_site\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
            let selectedAnnoteEl;
            const selectorForAnnotation = ( cell, annotation) => {
              let cellAttr = 'data-code-cell="' + cell + '"';
              let lineAttr = 'data-code-annotation="' +  annotation + '"';
              const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
              return selector;
            }
            const selectCodeLines = (annoteEl) => {
              const doc = window.document;
              const targetCell = annoteEl.getAttribute("data-target-cell");
              const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
              const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
              const lines = annoteSpan.getAttribute("data-code-lines").split(",");
              const lineIds = lines.map((line) => {
                return targetCell + "-" + line;
              })
              let top = null;
              let height = null;
              let parent = null;
              if (lineIds.length > 0) {
                  //compute the position of the single el (top and bottom and make a div)
                  const el = window.document.getElementById(lineIds[0]);
                  top = el.offsetTop;
                  height = el.offsetHeight;
                  parent = el.parentElement.parentElement;
                if (lineIds.length > 1) {
                  const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                  const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                  height = bottom - top;
                }
                if (top !== null && height !== null && parent !== null) {
                  // cook up a div (if necessary) and position it 
                  let div = window.document.getElementById("code-annotation-line-highlight");
                  if (div === null) {
                    div = window.document.createElement("div");
                    div.setAttribute("id", "code-annotation-line-highlight");
                    div.style.position = 'absolute';
                    parent.appendChild(div);
                  }
                  div.style.top = top - 2 + "px";
                  div.style.height = height + 4 + "px";
                  div.style.left = 0;
                  let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                  if (gutterDiv === null) {
                    gutterDiv = window.document.createElement("div");
                    gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                    gutterDiv.style.position = 'absolute';
                    const codeCell = window.document.getElementById(targetCell);
                    const gutter = codeCell.querySelector('.code-annotation-gutter');
                    gutter.appendChild(gutterDiv);
                  }
                  gutterDiv.style.top = top - 2 + "px";
                  gutterDiv.style.height = height + 4 + "px";
                }
                selectedAnnoteEl = annoteEl;
              }
            };
            const unselectCodeLines = () => {
              const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
              elementsIds.forEach((elId) => {
                const div = window.document.getElementById(elId);
                if (div) {
                  div.remove();
                }
              });
              selectedAnnoteEl = undefined;
            };
              // Handle positioning of the toggle
          window.addEventListener(
            "resize",
            throttle(() => {
              elRect = undefined;
              if (selectedAnnoteEl) {
                selectCodeLines(selectedAnnoteEl);
              }
            }, 10)
          );
          function throttle(fn, ms) {
          let throttle = false;
          let timer;
            return (...args) => {
              if(!throttle) { // first call gets through
                  fn.apply(this, args);
                  throttle = true;
              } else { // all the others get throttled
                  if(timer) clearTimeout(timer); // cancel #2
                  timer = setTimeout(() => {
                    fn.apply(this, args);
                    timer = throttle = false;
                  }, ms);
              }
            };
          }
            // Attach click handler to the DT
            const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
            for (const annoteDlNode of annoteDls) {
              annoteDlNode.addEventListener('click', (event) => {
                const clickedEl = event.target;
                if (clickedEl !== selectedAnnoteEl) {
                  unselectCodeLines();
                  const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
                  if (activeEl) {
                    activeEl.classList.remove('code-annotation-active');
                  }
                  selectCodeLines(clickedEl);
                  clickedEl.classList.add('code-annotation-active');
                } else {
                  // Unselect the line
                  unselectCodeLines();
                  clickedEl.classList.remove('code-annotation-active');
                }
              });
            }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>